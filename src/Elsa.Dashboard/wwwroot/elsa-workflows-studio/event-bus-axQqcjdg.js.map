{"version":3,"file":"event-bus-axQqcjdg.js","sources":["src/services/custom-event-bus.js","src/services/event-bus.ts"],"sourcesContent":["// This is a modified copy of js-event-bus (https://github.com/bcerati/js-event-bus)/\r\n// This modification adds support for async handlers.\r\n\r\nexport default function () {\r\n  const that = this;\r\n  this.listeners = {};\r\n\r\n  this.registerListener = function (event, callback, number) {\r\n    const type = event.constructor.name;\r\n    number = this.validateNumber(number || 'any');\r\n\r\n    if (type !== 'Array') {\r\n      event = [event];\r\n    }\r\n\r\n    event.forEach(function (e) {\r\n      if (e.constructor.name !== 'String') {\r\n        throw new Error(\r\n          'Only `String` and array of `String` are accepted for the event names!'\r\n        );\r\n      }\r\n\r\n      that.listeners[e] = that.listeners[e] || [];\r\n      that.listeners[e].push({\r\n        callback: callback,\r\n        number: number,\r\n      });\r\n    });\r\n  };\r\n\r\n  // validate that the number is a valid number for the number of executions\r\n  this.validateNumber = function (n) {\r\n    const type = n.constructor.name;\r\n\r\n    if (type === 'Number')\r\n      return n;\r\n    else if (type === 'String' && n.toLowerCase() === 'any')\r\n      return 'any';\r\n\r\n    throw new Error(\r\n      'Only `Number` and `any` are accepted in the number of possible executions!'\r\n    );\r\n  };\r\n\r\n  // return whether or not this event needs to be removed\r\n  this.toBeRemoved = function (info) {\r\n    const number = info.number;\r\n    info.execution = info.execution || 0;\r\n    info.execution++;\r\n\r\n    return !(number === 'any' || info.execution < number);\r\n\r\n\r\n  };\r\n\r\n  return {\r\n    /**\r\n     * Attach a callback to an event\r\n     * @param {string} eventName - name of the event.\r\n     * @param {function} callback - callback executed when this event is triggered\r\n     */\r\n    on(eventName, callback) {\r\n      that.registerListener.bind(that)(eventName, callback, 'any');\r\n    },\r\n\r\n    /**\r\n     * Attach a callback to an event. This callback will not be executed more than once if the event is trigger mutiple times\r\n     * @param {string} eventName - name of the event.\r\n     * @param {function} callback - callback executed when this event is triggered\r\n     */\r\n    once(eventName, callback) {\r\n      that.registerListener.bind(that)(eventName, callback, 1);\r\n    },\r\n\r\n    /**\r\n     * Attach a callback to an event. This callback will be executed will not be executed more than the number if the event is trigger mutiple times\r\n     * @param {number} number - max number of executions\r\n     * @param {string} eventName - name of the event.\r\n     * @param {function} callback - callback executed when this event is triggered\r\n     */\r\n    exactly(number, eventName, callback) {\r\n      that.registerListener.bind(that)(eventName, callback, number);\r\n    },\r\n\r\n    /**\r\n     * Kill an event with all it's callbacks\r\n     * @param {string} eventName - name of the event.\r\n     */\r\n    die(eventName) {\r\n      delete that.listeners[eventName];\r\n    },\r\n\r\n    /**\r\n     * Kill an event with all it's callbacks\r\n     * @param {string} eventName - name of the event.\r\n     */\r\n    off(eventName) {\r\n      this.die(eventName);\r\n    },\r\n\r\n    /**\r\n     * Remove the callback for the given event\r\n     * @param {string} eventName - name of the event.\r\n     * @param {callback} callback - the callback to remove (undefined to remove all of them).\r\n     */\r\n    detach(eventName, callback) {\r\n      if (callback === undefined) {\r\n        that.listeners[eventName] = [];\r\n        return true;\r\n      }\r\n\r\n      for (var k in that.listeners[eventName]) {\r\n        if (\r\n          that.listeners[eventName].hasOwnProperty(k) &&\r\n          that.listeners[eventName][k].callback === callback\r\n        ) {\r\n          that.listeners[eventName].splice(k, 1);\r\n          return this.detach(eventName, callback);\r\n        }\r\n      }\r\n\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Remove all the events\r\n     */\r\n    detachAll() {\r\n      for (const eventName in that.listeners) {\r\n        if (that.listeners.hasOwnProperty(eventName))\r\n          this.detach(eventName);\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Emit the event\r\n     * @param {string} eventName - name of the event.\r\n     */\r\n    async emit(eventName, context) {\r\n      const listeners = [];\r\n      for (const name in that.listeners) {\r\n        if (that.listeners.hasOwnProperty(name)) {\r\n          if (name === eventName) {\r\n            //TODO: this lib should definitely use > ES5\r\n            Array.prototype.push.apply(listeners, that.listeners[name]);\r\n          }\r\n\r\n          if (name.indexOf('*') >= 0) {\r\n            let newName = name.replace(/\\*\\*/, '([^.]+.?)+');\r\n            newName = newName.replace(/\\*/g, '[^.]+');\r\n\r\n            const match = eventName.match(newName);\r\n            if (match && eventName === match[0]) {\r\n              Array.prototype.push.apply(listeners, that.listeners[name]);\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      const parentArgs = arguments;\r\n\r\n      context = context || this;\r\n      let index = 0;\r\n      for (const info of listeners) {\r\n\r\n        let callback = info.callback;\r\n        const number = info.number;\r\n\r\n        if (context) {\r\n          callback = callback.bind(context);\r\n        }\r\n\r\n        const args = [];\r\n        Object.keys(parentArgs).map(function (i) {\r\n          if (i > 1) {\r\n            args.push(parentArgs[i]);\r\n          }\r\n        });\r\n\r\n        // this event cannot be fired again, remove from the stack\r\n        if (that.toBeRemoved(info)) {\r\n          that.listeners[eventName].splice(index, 1);\r\n        }\r\n\r\n        const result = callback.apply(null, args);\r\n\r\n        if (!!result)\r\n          await result;\r\n\r\n        index++;\r\n      }\r\n    },\r\n  };\r\n};\r\n","ï»¿import EventBus from './custom-event-bus';\r\n\r\nexport const eventBus = new EventBus();\r\n"],"names":[],"mappings":"AAAA;AACA;AACA;AACe,iBAAQ,IAAI;AAC3B,EAAE,MAAM,IAAI,GAAG,IAAI,CAAC;AACpB,EAAE,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;AACtB;AACA,EAAE,IAAI,CAAC,gBAAgB,GAAG,UAAU,KAAK,EAAE,QAAQ,EAAE,MAAM,EAAE;AAC7D,IAAI,MAAM,IAAI,GAAG,KAAK,CAAC,WAAW,CAAC,IAAI,CAAC;AACxC,IAAI,MAAM,GAAG,IAAI,CAAC,cAAc,CAAC,MAAM,IAAI,KAAK,CAAC,CAAC;AAClD;AACA,IAAI,IAAI,IAAI,KAAK,OAAO,EAAE;AAC1B,MAAM,KAAK,GAAG,CAAC,KAAK,CAAC,CAAC;AACtB,KAAK;AACL;AACA,IAAI,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,EAAE;AAC/B,MAAM,IAAI,CAAC,CAAC,WAAW,CAAC,IAAI,KAAK,QAAQ,EAAE;AAC3C,QAAQ,MAAM,IAAI,KAAK;AACvB,UAAU,uEAAuE;AACjF,SAAS,CAAC;AACV,OAAO;AACP;AACA,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC;AAClD,MAAM,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC;AAC7B,QAAQ,QAAQ,EAAE,QAAQ;AAC1B,QAAQ,MAAM,EAAE,MAAM;AACtB,OAAO,CAAC,CAAC;AACT,KAAK,CAAC,CAAC;AACP,GAAG,CAAC;AACJ;AACA;AACA,EAAE,IAAI,CAAC,cAAc,GAAG,UAAU,CAAC,EAAE;AACrC,IAAI,MAAM,IAAI,GAAG,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC;AACpC;AACA,IAAI,IAAI,IAAI,KAAK,QAAQ;AACzB,MAAM,OAAO,CAAC,CAAC;AACf,SAAS,IAAI,IAAI,KAAK,QAAQ,IAAI,CAAC,CAAC,WAAW,EAAE,KAAK,KAAK;AAC3D,MAAM,OAAO,KAAK,CAAC;AACnB;AACA,IAAI,MAAM,IAAI,KAAK;AACnB,MAAM,4EAA4E;AAClF,KAAK,CAAC;AACN,GAAG,CAAC;AACJ;AACA;AACA,EAAE,IAAI,CAAC,WAAW,GAAG,UAAU,IAAI,EAAE;AACrC,IAAI,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AAC/B,IAAI,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC,SAAS,IAAI,CAAC,CAAC;AACzC,IAAI,IAAI,CAAC,SAAS,EAAE,CAAC;AACrB;AACA,IAAI,OAAO,EAAE,MAAM,KAAK,KAAK,IAAI,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC,CAAC;AAC1D;AACA;AACA,GAAG,CAAC;AACJ;AACA,EAAE,OAAO;AACT;AACA;AACA;AACA;AACA;AACA,IAAI,EAAE,CAAC,SAAS,EAAE,QAAQ,EAAE;AAC5B,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,KAAK,CAAC,CAAC;AACnE,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,IAAI,CAAC,SAAS,EAAE,QAAQ,EAAE;AAC9B,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC;AAC/D,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,OAAO,CAAC,MAAM,EAAE,SAAS,EAAE,QAAQ,EAAE;AACzC,MAAM,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,MAAM,CAAC,CAAC;AACpE,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAI,GAAG,CAAC,SAAS,EAAE;AACnB,MAAM,OAAO,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC;AACvC,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAI,GAAG,CAAC,SAAS,EAAE;AACnB,MAAM,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;AAC1B,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE;AAChC,MAAM,IAAI,QAAQ,KAAK,SAAS,EAAE;AAClC,QAAQ,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,GAAG,EAAE,CAAC;AACvC,QAAQ,OAAO,IAAI,CAAC;AACpB,OAAO;AACP;AACA,MAAM,KAAK,IAAI,CAAC,IAAI,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,EAAE;AAC/C,QAAQ;AACR,UAAU,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,cAAc,CAAC,CAAC,CAAC;AACrD,UAAU,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,QAAQ,KAAK,QAAQ;AAC5D,UAAU;AACV,UAAU,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AACjD,UAAU,OAAO,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC;AAClD,SAAS;AACT,OAAO;AACP;AACA,MAAM,OAAO,IAAI,CAAC;AAClB,KAAK;AACL;AACA;AACA;AACA;AACA,IAAI,SAAS,GAAG;AAChB,MAAM,KAAK,MAAM,SAAS,IAAI,IAAI,CAAC,SAAS,EAAE;AAC9C,QAAQ,IAAI,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,SAAS,CAAC;AACpD,UAAU,IAAI,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AACjC,OAAO;AACP,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,IAAI,MAAM,IAAI,CAAC,SAAS,EAAE,OAAO,EAAE;AACnC,MAAM,MAAM,SAAS,GAAG,EAAE,CAAC;AAC3B,MAAM,KAAK,MAAM,IAAI,IAAI,IAAI,CAAC,SAAS,EAAE;AACzC,QAAQ,IAAI,IAAI,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,EAAE;AACjD,UAAU,IAAI,IAAI,KAAK,SAAS,EAAE;AAClC;AACA,YAAY,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;AACxE,WAAW;AACX;AACA,UAAU,IAAI,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;AACtC,YAAY,IAAI,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,YAAY,CAAC,CAAC;AAC7D,YAAY,OAAO,GAAG,OAAO,CAAC,OAAO,CAAC,KAAK,EAAE,OAAO,CAAC,CAAC;AACtD;AACA,YAAY,MAAM,KAAK,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;AACnD,YAAY,IAAI,KAAK,IAAI,SAAS,KAAK,KAAK,CAAC,CAAC,CAAC,EAAE;AACjD,cAAc,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC;AAC1E,aAAa;AACb,WAAW;AACX,SAAS;AACT,OAAO;AACP;AACA,MAAM,MAAM,UAAU,GAAG,SAAS,CAAC;AACnC;AACA,MAAM,OAAO,GAAG,OAAO,IAAI,IAAI,CAAC;AAChC,MAAM,IAAI,KAAK,GAAG,CAAC,CAAC;AACpB,MAAM,KAAK,MAAM,IAAI,IAAI,SAAS,EAAE;AACpC;AACA,QAAQ,IAAI,QAAQ,GAAG,IAAI,CAAC,QAAQ,CAAC;AACrC,QAAQ,MAAM,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC;AACnC;AACA,QAAQ,IAAI,OAAO,EAAE;AACrB,UAAU,QAAQ,GAAG,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;AAC5C,SAAS;AACT;AACA,QAAQ,MAAM,IAAI,GAAG,EAAE,CAAC;AACxB,QAAQ,MAAM,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;AACjD,UAAU,IAAI,CAAC,GAAG,CAAC,EAAE;AACrB,YAAY,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC;AACrC,WAAW;AACX,SAAS,CAAC,CAAC;AACX;AACA;AACA,QAAQ,IAAI,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,EAAE;AACpC,UAAU,IAAI,CAAC,SAAS,CAAC,SAAS,CAAC,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC;AACrD,SAAS;AACT;AACA,QAAQ,MAAM,MAAM,GAAG,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AAClD;AACA,QAAQ,IAAI,CAAC,CAAC,MAAM;AACpB,UAAU,MAAM,MAAM,CAAC;AACvB;AACA,QAAQ,KAAK,EAAE,CAAC;AAChB,OAAO;AACP,KAAK;AACL,GAAG,CAAC;AACJ,CAAC;;AC/LY,MAAA,QAAQ,GAAG,IAAI,QAAQ;;;;"}