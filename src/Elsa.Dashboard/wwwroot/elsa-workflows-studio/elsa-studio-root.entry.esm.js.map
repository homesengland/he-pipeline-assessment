{"version":3,"file":"elsa-studio-root.entry.esm.js","sources":["src/components/dashboard/pages/elsa-studio-root/elsa-studio-root.tsx"],"sourcesContent":["import {Component, Event, EventEmitter, h, Listen, Method, Prop, State} from '@stencil/core';\nimport Tunnel, {DashboardState} from \"../../../../data/dashboard\";\nimport {ElsaStudio, WorkflowModel} from \"../../../../models\";\nimport {\n  eventBus,\n  pluginManager,\n  activityIconProvider,\n  confirmDialogService,\n  toastNotificationService,\n  createElsaClient,\n  createHttpClient,\n  ElsaClient,\n  propertyDisplayManager,\n  featuresDataManager\n} from \"../../../../services\";\nimport { HttpClient } from '../../../../services'; // Using fetch-based HttpClient interface\nimport {EventTypes} from \"../../../../models\";\nimport {ToastNotificationOptions} from \"../../../shared/elsa-toast-notification/elsa-toast-notification\";\nimport {getOrCreateProperty, htmlToElement} from \"../../../../utils/utils\";\nimport state from '../../../../utils/store';\n\n@Component({\n  tag: 'elsa-studio-root',\n  shadow: false\n})\nexport class ElsaStudioRoot {\n\n  @Prop({attribute: 'server-url', reflect: true}) serverUrl: string;\n  @Prop({attribute: 'monaco-lib-path', reflect: true}) monacoLibPath: string;\n  @Prop({attribute: 'culture', reflect: true}) culture: string;\n  @Prop({attribute: 'base-path', reflect: true}) basePath: string = '';\n  @Prop({attribute: 'use-x6-graphs', reflect: true}) useX6Graphs: boolean = false;\n  @Prop() features: any;\n  @Prop() config: string;\n  @State() featuresConfig: any;\n  @Event() initializing: EventEmitter<ElsaStudio>;\n  @Event() initialized: EventEmitter<ElsaStudio>;\n\n  private confirmDialog: HTMLElsaConfirmDialogElement;\n  private toastNotificationElement: HTMLElsaToastNotificationElement;\n  private elsaStudio: ElsaStudio;\n\n  @Method()\n  async addPlugins(pluginTypes: Array<any>) {\n    pluginManager.registerPlugins(pluginTypes);\n  }\n\n  @Method()\n  async addPlugin(pluginType: any) {\n    pluginManager.registerPlugin(pluginType);\n  }\n\n  @Listen('workflow-changed')\n  workflowChangedHandler(event: CustomEvent<WorkflowModel>) {\n    eventBus.emit(EventTypes.WorkflowModelChanged, this, event.detail);\n  }\n\n  connectedCallback() {\n    eventBus.on(EventTypes.ShowConfirmDialog, this.onShowConfirmDialog);\n    eventBus.on(EventTypes.HideConfirmDialog, this.onHideConfirmDialog);\n    eventBus.on(EventTypes.ShowToastNotification, this.onShowToastNotification);\n    eventBus.on(EventTypes.HideToastNotification, this.onHideToastNotification);\n  }\n\n  disconnectedCallback() {\n    eventBus.detach(EventTypes.ShowConfirmDialog, this.onShowConfirmDialog);\n    eventBus.detach(EventTypes.HideConfirmDialog, this.onHideConfirmDialog);\n    eventBus.detach(EventTypes.ShowToastNotification, this.onShowToastNotification);\n    eventBus.detach(EventTypes.HideToastNotification, this.onHideToastNotification);\n  }\n\n  async componentWillLoad() {\n    state.useX6Graphs = this.useX6Graphs;\n\n  const elsaClientFactory: () => Promise<ElsaClient> = () => createElsaClient(this.serverUrl);\n  const httpClientFactory: () => Promise<HttpClient> = () => createHttpClient(this.serverUrl);\n\n    if (this.config) {\n      await fetch(`${document.location.origin}/${this.config}`)\n        .then(response => {\n          if (!response.ok) {\n            throw new Error(\"HTTP error \" + response.status);\n          }\n\n          return response.json()\n        })\n        .then(data => {\n          this.featuresConfig = data;\n        }).catch((error) => {\n          console.error(error)\n        });\n    }\n\n    const elsaStudio: ElsaStudio = this.elsaStudio = {\n      serverUrl: this.serverUrl,\n      basePath: this.basePath,\n      features: this.featuresConfig,\n      serverFeatures: [],\n      serverVersion: null,\n      eventBus,\n      pluginManager,\n      propertyDisplayManager,\n      activityIconProvider,\n      confirmDialogService,\n      toastNotificationService,\n      elsaClientFactory,\n      httpClientFactory,\n      getOrCreateProperty: getOrCreateProperty,\n      htmlToElement\n    };\n\n    this.initializing.emit(elsaStudio);\n    pluginManager.initialize(elsaStudio);\n    await eventBus.emit(EventTypes.Root.Initializing);\n    propertyDisplayManager.initialize(elsaStudio);\n    featuresDataManager.initialize(elsaStudio);\n\n    const elsaClient = await elsaClientFactory();\n    elsaStudio.serverFeatures = await elsaClient.featuresApi.list();\n    elsaStudio.serverVersion = await elsaClient.versionApi.get();\n  }\n\n  async componentDidLoad() {\n    this.initialized.emit(this.elsaStudio);\n    await eventBus.emit(EventTypes.Root.Initialized);\n  }\n\n  onShowConfirmDialog = (e) => e.promise = this.confirmDialog.show(e.caption, e.message)\n  onHideConfirmDialog = async () => await this.confirmDialog.hide()\n  onShowToastNotification = async (e: ToastNotificationOptions) => await this.toastNotificationElement.show(e)\n  onHideToastNotification = async () => await this.toastNotificationElement.hide()\n\n  render() {\n\n    const culture = this.culture;\n\n    const tunnelState: DashboardState = {\n      serverUrl: this.serverUrl,\n      basePath: this.basePath,\n      serverFeatures: this.elsaStudio.serverFeatures,\n      serverVersion: this.elsaStudio.serverVersion,\n      culture,\n      monacoLibPath: this.monacoLibPath\n    };\n\n    return (\n      <Tunnel.Provider state={tunnelState}>\n        <slot/>\n        <elsa-confirm-dialog ref={el => this.confirmDialog = el} culture={this.culture}/>\n        <elsa-toast-notification ref={el => this.toastNotificationElement = el}/>\n      </Tunnel.Provider>\n    );\n  }\n}\n"],"names":[],"mappings":"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"}