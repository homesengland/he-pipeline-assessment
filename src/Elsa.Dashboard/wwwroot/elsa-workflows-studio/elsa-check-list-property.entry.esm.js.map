{"version":3,"file":"elsa-check-list-property.entry.esm.js","sources":["src/components/editors/properties/elsa-check-list-property/elsa-check-list-property.tsx"],"sourcesContent":["import {Component, h, Prop, State} from '@stencil/core';\r\nimport {\r\n  ActivityDefinitionProperty,\r\n  ActivityModel,\r\n  ActivityPropertyDescriptor,\r\n  SelectList,\r\n  SyntaxNames\r\n} from \"../../../../models\";\r\nimport {parseJson} from \"../../../../utils/utils\";\r\nimport {getSelectListItems} from \"../../../../utils/select-list-items\";\r\nimport Tunnel from \"../../../../data/workflow-editor\";\r\n\r\n@Component({\r\n  tag: 'elsa-check-list-property',\r\n  shadow: false,\r\n})\r\nexport class ElsaCheckListProperty {\r\n\r\n  @Prop() activityModel: ActivityModel;\r\n  @Prop() propertyDescriptor: ActivityPropertyDescriptor;\r\n  @Prop() propertyModel: ActivityDefinitionProperty;\r\n  @Prop({mutable: true}) serverUrl: string;\r\n  @State() currentValue?: string;\r\n\r\n  monacoEditor: HTMLElsaMonacoElement;\r\n  selectList: SelectList = {items: [], isFlagsEnum: false};\r\n\r\n  async componentWillLoad() {\r\n    if (this.propertyModel.expressions[SyntaxNames.Json] == undefined)\r\n      this.propertyModel.expressions[SyntaxNames.Json] = JSON.stringify(this.propertyDescriptor.defaultValue);\r\n    this.currentValue = this.propertyModel.expressions[SyntaxNames.Json] || '[]';\r\n  }\r\n\r\n  onCheckChanged(e: Event) {\r\n    const checkbox = (e.target as HTMLInputElement);\r\n    const checked = checkbox.checked;\r\n    const value = checkbox.value;\r\n    const isFlags = this.selectList.isFlagsEnum;\r\n\r\n    if (isFlags) {\r\n      let newValue = parseInt(this.currentValue as string);\r\n\r\n      if (checked)\r\n        newValue = newValue | parseInt(value);\r\n      else\r\n        newValue = newValue & ~parseInt(value);\r\n\r\n      this.currentValue = newValue.toString();\r\n\r\n    } else {\r\n      let newValue = parseJson(this.currentValue as string);\r\n\r\n      if (checked)\r\n        newValue = [...newValue, value].distinct();\r\n      else\r\n        newValue = newValue.filter(x => x !== value);\r\n\r\n      this.currentValue = JSON.stringify(newValue);\r\n    }\r\n\r\n    this.propertyModel.expressions[SyntaxNames.Json] = this.currentValue.toString();\r\n  }\r\n\r\n  onDefaultSyntaxValueChanged(e: CustomEvent) {\r\n    this.currentValue = e.detail;\r\n  }\r\n\r\n  async componentWillRender() {\r\n    this.selectList = await getSelectListItems(this.serverUrl, this.propertyDescriptor);\r\n  }\r\n\r\n  render() {\r\n    const propertyDescriptor = this.propertyDescriptor;\r\n    const propertyModel = this.propertyModel;\r\n    const fieldId = propertyDescriptor.name;\r\n    const selectList = this.selectList;\r\n    const items = selectList.items;\r\n    const selectedValues = selectList.isFlagsEnum ? this.currentValue : parseJson(this.currentValue as string) || [];\r\n\r\n    return (\r\n      <elsa-property-editor\r\n        activityModel={this.activityModel}\r\n        propertyDescriptor={propertyDescriptor}\r\n        propertyModel={propertyModel}\r\n        onDefaultSyntaxValueChanged={e => this.onDefaultSyntaxValueChanged(e)}\r\n        single-line={true}>\r\n        <div class=\"elsa-max-w-lg elsa-space-y-3 elsa-my-4\">\r\n          {items.map((item, index) => {\r\n            const inputId = `${fieldId}_${index}`;\r\n            const optionIsString = typeof (item) == 'string';\r\n            const value = optionIsString ? item : item.value;\r\n            const text = optionIsString ? item : item.text;\r\n            const isSelected = selectList.isFlagsEnum\r\n              ? ((parseInt(this.currentValue)) & (parseInt(value as string))) == parseInt(value as string)\r\n              : selectedValues.findIndex(x => x == value) >= 0;\r\n\r\n            return (\r\n              <div class=\"elsa-relative elsa-flex elsa-items-start\">\r\n                <div class=\"elsa-flex elsa-items-center elsa-h-5\">\r\n                  <input id={inputId} type=\"checkbox\" checked={isSelected} value={value}\r\n                         onChange={e => this.onCheckChanged(e)}\r\n                         class=\"focus:elsa-ring-blue-500 elsa-h-4 elsa-w-4 elsa-text-blue-600 elsa-border-gray-300 elsa-rounded\"/>\r\n                </div>\r\n                <div class=\"elsa-ml-3 elsa-mt-1 elsa-text-sm\">\r\n                  <label htmlFor={inputId} class=\"elsa-font-medium elsa-text-gray-700\">{text}</label>\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      </elsa-property-editor>\r\n    );\r\n  }\r\n}\r\n\r\nTunnel.injectProps(ElsaCheckListProperty, ['serverUrl']);\r\n"],"names":[],"mappings":"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"}