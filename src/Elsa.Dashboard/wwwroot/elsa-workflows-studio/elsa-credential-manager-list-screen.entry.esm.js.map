{"version":3,"file":"elsa-credential-manager-list-screen.entry.esm.js","sources":["src/modules/credential-manager/components/credential-manager-list-screen.tsx"],"sourcesContent":["import { Component, h, Prop, State } from \"@stencil/core\";\nimport { RouterHistory } from \"@stencil-community/router\";\nimport {  eventBus } from \"../../..\";\nimport { WebhookDefinitionSummary } from \"../../elsa-webhooks/models\";\nimport Tunnel from \"../../../data/dashboard\";\nimport { createElsaSecretsClient, ElsaSecretsClient } from \"../services/credential-manager.client\";\nimport { SecretDescriptor, SecretModel } from \"../models/secret.model\";\nimport { SecretEventTypes } from \"../models/secret.events\";\n\n@Component({\n    tag: 'elsa-credential-manager-list-screen',\n    shadow: false\n})\nexport class CredentialManagerListScreen {\n    @Prop() history?: RouterHistory;\n    @Prop() serverUrl: string;\n    @Prop() basePath: string;\n    @Prop() culture: string;\n    @State() secrets: Array<SecretModel> = []\n\n    confirmDialog: HTMLElsaConfirmDialogElement;\n    client: ElsaSecretsClient;\n\n    async componentWillLoad() {\n      await this.loadSecrets();\n    }\n\n    async connectedCallback() {\n      eventBus.on(SecretEventTypes.SecretPicked, this.onSecretPicked);\n      eventBus.on(SecretEventTypes.SecretUpdated, () => this.loadSecrets());\n\n      window.addEventListener(\"message\", this.listenToMessages);\n    }\n\n    async disconnectedCallback() {\n      eventBus.detach(SecretEventTypes.SecretPicked, this.onSecretPicked);\n      eventBus.detach(SecretEventTypes.SecretUpdated, () => this.loadSecrets());\n\n      window.removeEventListener(\"message\", this.listenToMessages);\n    }\n\n    listenToMessages = (e: MessageEvent) => {\n      if (e.origin !== window.origin) {\n        return;\n      }\n      if (e.data == \"refreshSecrets\") {\n        this.loadSecrets();\n      }\n    }\n\n    onSecretPicked = async args => {\n      const secretDescriptor = args as any;\n      const secretModel = this.newSecret(secretDescriptor);\n\n      await this.showSecretEditorInternal(secretModel, false);\n    };\n\n    async onSecretEdit(e, secret) {\n      const properties = secret.properties;\n      const secretModel: SecretModel = {\n        id: secret.id,\n        displayName: secret.displayName,\n        name: secret.name,\n        type: secret.type,\n        properties: this.mapProperties(properties)\n      };\n\n      await this.showSecretEditorInternal(secretModel, true);\n    }\n\n    mapProperties(properties) {\n      return properties.map(prop => {\n        return {\n          expressions: {\n            Literal: prop.expressions.Literal\n          },\n          name: prop.name\n        }\n      });\n    }\n\n    async showSecretEditorInternal(secret: SecretModel, animate: boolean) {\n      await eventBus.emit(SecretEventTypes.SecretsEditor.Show, this, secret, animate);\n    }\n\n    newSecret(secretDescriptor: SecretDescriptor): any {\n      const secret: SecretModel = {\n        type: secretDescriptor.type,\n        displayName: secretDescriptor.displayName,\n        name: secretDescriptor.displayName,\n        properties: [],\n      };\n\n      for (const property of secretDescriptor.inputProperties) {\n        secret.properties[property.name] = {\n          syntax: '',\n          expression: '',\n        };\n      }\n\n      return secret;\n    }\n\n    async onDeleteClick(e: Event, webhookDefinition: WebhookDefinitionSummary) {\n      const result = await this.confirmDialog.show('Delete Secret', 'Are you sure you wish to permanently delete this secret?');\n\n      if (!result)\n        return;\n\n      const elsaClient = await createElsaSecretsClient(this.serverUrl);\n      await elsaClient.secretsApi.delete(webhookDefinition.id);\n      await this.loadSecrets();\n    }\n\n    async loadSecrets() {\n      const elsaClient = await createElsaSecretsClient(this.serverUrl);\n\n      this.secrets = await elsaClient.secretsApi.list();\n      await eventBus.emit(SecretEventTypes.SecretsLoaded, this, this.secrets);\n    }\n\n    render() {\n      const secrets = this.secrets;\n\n      return (\n        <div>\n          <div class=\"elsa-align-middle elsa-inline-block elsa-min-w-full elsa-border-b elsa-border-gray-200\">\n            <table class=\"elsa-min-w-full\">\n              <thead>\n              <tr class=\"elsa-border-t elsa-border-gray-200\">\n                <th class=\"elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-left elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-uppercase elsa-tracking-wider\"><span class=\"lg:elsa-pl-2\">Name</span></th>\n                <th class=\"elsa-px-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-left elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-uppercase elsa-tracking-wider\">\n                  Type\n                </th>\n                <th class=\"elsa-pr-6 elsa-py-3 elsa-border-b elsa-border-gray-200 elsa-bg-gray-50 elsa-text-right elsa-text-xs elsa-leading-4 elsa-font-medium elsa-text-gray-500 elsa-uppercase elsa-tracking-wider\"/>\n              </tr>\n              </thead>\n              <tbody class=\"elsa-bg-white elsa-divide-y elsa-divide-gray-100\">\n              {secrets?.map(item => {\n\n                const editIcon = (\n                  <svg class=\"elsa-h-5 elsa-w-5 elsa-text-gray-500\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path d=\"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7\"/>\n                    <path d=\"M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z\"/>\n                  </svg>\n                );\n\n                const deleteIcon = (\n                  <svg class=\"elsa-h-5 elsa-w-5 elsa-text-gray-500\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\n                    <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\n                    <line x1=\"4\" y1=\"7\" x2=\"20\" y2=\"7\"/>\n                    <line x1=\"10\" y1=\"11\" x2=\"10\" y2=\"17\"/>\n                    <line x1=\"14\" y1=\"11\" x2=\"14\" y2=\"17\"/>\n                    <path d=\"M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12\"/>\n                    <path d=\"M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3\"/>\n                  </svg>\n                );\n\n                return (\n                  <tr>\n                    <td class=\"elsa-px-6 elsa-py-3 elsa-whitespace-no-wrap elsa-text-sm elsa-leading-5 elsa-font-medium elsa-text-gray-900\">\n                      <div class=\"elsa-flex elsa-items-center elsa-space-x-3 lg:elsa-pl-2\">\n                        {item.name}\n                      </div>\n                    </td>\n\n                    <td class=\"elsa-px-6 elsa-py-3 elsa-text-sm elsa-leading-5 elsa-text-gray-500 elsa-font-medium\">\n                      <div class=\"elsa-flex elsa-items-center elsa-space-x-3 lg:elsa-pl-2\">\n                        {item.type}\n                      </div>\n                    </td>\n\n                    <td class=\"elsa-pr-6\">\n                      <elsa-context-menu history={this.history} menuItems={[\n                        {text: 'Edit', clickHandler: e => this.onSecretEdit(e, item), icon: editIcon},\n                        {text: 'Delete', clickHandler: e => this.onDeleteClick(e, item), icon: deleteIcon}\n                      ]}/>\n                    </td>\n                  </tr>\n                );\n              })}\n              </tbody>\n            </table>\n          </div>\n\n          <elsa-confirm-dialog ref={el => this.confirmDialog = el}/>\n        </div>\n      );\n    }\n}\nTunnel.injectProps(CredentialManagerListScreen, ['serverUrl', 'culture', 'basePath']);\n"],"names":[],"mappings":"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"}