{"version":3,"file":"elsa-dictionary-property.entry.esm.js","sources":["src/components/editors/properties/elsa-dictionary-property/elsa-dictionary-property.tsx"],"sourcesContent":["ï»¿import {Component, h, Host, Prop, State} from '@stencil/core';\r\nimport {ActivityDefinitionProperty, ActivityModel, ActivityPropertyDescriptor, SyntaxNames} from \"../../../../models\";\r\nimport Tunnel from \"../../../../data/workflow-editor\";\r\nimport {IconColor, IconName, iconProvider} from \"../../../../services/icon-provider\"\r\n\r\n@Component({\r\n  tag: 'elsa-dictionary-property',\r\n  shadow: false,\r\n})\r\nexport class ElsaDictionaryProperty {\r\n\r\n  @Prop() propertyDescriptor: ActivityPropertyDescriptor;\r\n  @Prop() propertyModel: ActivityDefinitionProperty;\r\n  @Prop() activityModel: ActivityModel;\r\n  @Prop({mutable: true}) serverUrl: string;\r\n  @State() currentValue: [string, string][];\r\n\r\n  async componentWillLoad() {\r\n    this.currentValue = this.jsonToDictionary(this.propertyModel.expressions[SyntaxNames.Json] || null);\r\n    if (this.currentValue.length === 0) this.currentValue = [['', '']];\r\n  }\r\n\r\n  jsonToDictionary = (json: string): [string, string][] => {\r\n    if (!json) return [['', '']];\r\n\r\n    const parsedValue = JSON.parse(json);\r\n\r\n    return Object.keys(parsedValue).map(key => [key, parsedValue[key]]);\r\n  }\r\n\r\n  dictionaryToJson = (dictionary: [string, string][]) => {\r\n    const filteredDictionary = this.removeInvalidKeys(dictionary);\r\n\r\n    if (filteredDictionary.length === 0) return null;\r\n\r\n    return JSON.stringify(Object.fromEntries(filteredDictionary));\r\n  }\r\n\r\n  removeInvalidKeys = (dictionary: [string, string][]) => {\r\n    const filteredDictionary = [];\r\n\r\n    dictionary.forEach(x => {\r\n      const key = x[0].trim();\r\n      if (key !== '' && !filteredDictionary.some(y => y[0].trim() === key))\r\n        filteredDictionary.push(x);\r\n    });\r\n\r\n    return filteredDictionary;\r\n  }\r\n\r\n  onRowAdded = () => {\r\n    //changing contents of array won't trigger state change,\r\n    //need to update the reference by creating new array\r\n    this.currentValue = [...this.currentValue, ['', '']];\r\n  }\r\n\r\n  onRowDeleted = (index: number) => {\r\n    const newValue = this.currentValue.filter((x, i) => i !== index);\r\n\r\n    if (newValue.length === 0) newValue.push(['', '']);\r\n\r\n    this.currentValue = newValue;\r\n    this.propertyModel.expressions[SyntaxNames.Json] = this.dictionaryToJson(newValue);\r\n  }\r\n\r\n  onDefaultSyntaxValueChanged(e: CustomEvent) {\r\n    this.currentValue = this.jsonToDictionary(e.detail);\r\n  }\r\n\r\n  onKeyChanged(e: Event, index: number) {\r\n    const input = e.currentTarget as HTMLInputElement;\r\n    this.currentValue[index][0] = input.value\r\n    this.propertyModel.expressions[SyntaxNames.Json] = this.dictionaryToJson(this.currentValue);\r\n  }\r\n\r\n  onValueChanged(e: Event, index: number) {\r\n    const input = e.currentTarget as HTMLInputElement;\r\n    this.currentValue[index][1] = input.value\r\n    this.propertyModel.expressions[SyntaxNames.Json] = this.dictionaryToJson(this.currentValue);\r\n  }\r\n\r\n  render() {\r\n    const propertyDescriptor = this.propertyDescriptor;\r\n    const propertyModel = this.propertyModel;\r\n    const fieldId = propertyDescriptor.name;\r\n    const items = this.currentValue;\r\n\r\n    return (\r\n      <elsa-property-editor propertyDescriptor={propertyDescriptor}\r\n                            propertyModel={propertyModel}\r\n                            activityModel={this.activityModel}\r\n                            onDefaultSyntaxValueChanged={e => this.onDefaultSyntaxValueChanged(e)}\r\n                            single-line={true}>\r\n        {items.map((item, index) => {\r\n          const keyInputId = `${fieldId}_${index}_key}`;\r\n          const valueInputId = `${fieldId}_${index}_value}`;\r\n          const [key, value] = item;\r\n          const isLast = index === (items.length - 1);\r\n\r\n          return (\r\n            <div class=\"elsa-flex elsa-flex-row elsa-justify-between elsa-mb-2\">\r\n              <input id={keyInputId} type=\"text\" value={key} onChange={(e) => this.onKeyChanged(e, index)}\r\n                     placeholder=\"Name\"\r\n                     class=\"disabled:elsa-opacity-50 disabled:elsa-cursor-not-allowed focus:elsa-ring-blue-500 focus:elsa-border-blue-500 elsa-border-gray-300 sm:elsa-text-sm elsa-rounded-md elsa-w-5/12\"/>\r\n              <input id={valueInputId} type=\"text\" value={value} onChange={(e) => this.onValueChanged(e, index)}\r\n                     placeholder=\"Value\"\r\n                     class=\"disabled:elsa-opacity-50 disabled:elsa-cursor-not-allowed focus:elsa-ring-blue-500 focus:elsa-border-blue-500 elsa-border-gray-300 sm:elsa-text-sm elsa-rounded-md elsa-w-5/12\"/>\r\n              <div class=\"elsa-flex elsa-flex-row elsa-justify-between elsa-w-24\">\r\n                <button type=\"button\" onClick={() => this.onRowDeleted(index)}>\r\n                  {iconProvider.getIcon(IconName.TrashBinOutline, {color: IconColor.Gray, hoverColor: IconColor.Red})}\r\n                </button>\r\n                {isLast && <button type=\"button\" onClick={this.onRowAdded}>\r\n                  {iconProvider.getIcon(IconName.Plus, {color: IconColor.Gray, hoverColor: IconColor.Green})}\r\n                </button>}\r\n              </div>\r\n            </div>\r\n          );\r\n        })}\r\n      </elsa-property-editor>\r\n    );\r\n  }\r\n}\r\n\r\nTunnel.injectProps(ElsaDictionaryProperty, ['serverUrl']);\r\n"],"names":[],"mappings":"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"}