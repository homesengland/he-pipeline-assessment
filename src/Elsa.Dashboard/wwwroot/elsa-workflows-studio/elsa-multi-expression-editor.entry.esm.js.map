{"version":3,"file":"elsa-multi-expression-editor.entry.esm.js","sources":["src/components/editors/elsa-multi-expression-editor/elsa-multi-expression-editor.tsx"],"sourcesContent":["import {Component, Event, EventEmitter, Listen, h, Prop, State} from '@stencil/core';\r\nimport {SyntaxNames, IntellisenseContext} from \"../../../models\";\r\nimport {enter, leave, toggle} from 'el-transition'\r\nimport {Map, mapSyntaxToLanguage} from \"../../../utils/utils\";\r\n\r\n@Component({\r\n  tag: 'elsa-multi-expression-editor',\r\n  shadow: false,\r\n})\r\nexport class ElsaMultiExpressionEditor {\r\n\r\n  @Prop() label: string;\r\n  @Prop() fieldName?: string;\r\n  @Prop() syntax?: string;\r\n  @Prop() defaultSyntax: string = SyntaxNames.Literal;\r\n  @Prop() expressions: Map<string> = {};\r\n  @Prop() supportedSyntaxes: Array<string> = [];\r\n  @Prop() isReadOnly?: boolean;\r\n  @Prop({attribute: 'editor-height', reflect: true}) editorHeight: string = '10em';\r\n  @Prop({attribute: 'single-line', reflect: true}) singleLineMode: boolean = false;\r\n  @Prop() context?: IntellisenseContext;\r\n\r\n  @Event() syntaxChanged: EventEmitter<string>;\r\n  @Event() expressionChanged: EventEmitter<string>;\r\n\r\n  @State() selectedSyntax?: string;\r\n  @State() currentValue?: string;\r\n\r\n  contextMenu: HTMLElement;\r\n  expressionEditor: HTMLElsaExpressionEditorElement;\r\n  defaultSyntaxValue: string;\r\n  contextMenuWidget: HTMLElement;\r\n\r\n  async componentWillLoad() {\r\n    this.selectedSyntax = this.syntax;\r\n    this.currentValue = this.expressions[this.selectedSyntax ? this.selectedSyntax : this.defaultSyntax];\r\n  }\r\n\r\n  @Listen('click', {target: 'window'})\r\n  onWindowClicked(event: Event){\r\n    const target = event.target as HTMLElement;\r\n\r\n    if (!this.contextMenuWidget || !this.contextMenuWidget.contains(target))\r\n      this.closeContextMenu();\r\n  }\r\n\r\n  toggleContextMenu() {\r\n    toggle(this.contextMenu);\r\n  }\r\n\r\n  openContextMenu() {\r\n    enter(this.contextMenu);\r\n  }\r\n\r\n  closeContextMenu() {\r\n    if (!!this.contextMenu)\r\n      leave(this.contextMenu);\r\n  }\r\n\r\n  selectDefaultEditor(e: Event) {\r\n    e.preventDefault();\r\n    this.selectedSyntax = undefined;\r\n    this.closeContextMenu();\r\n  }\r\n\r\n  async selectSyntax(e: Event, syntax: string) {\r\n    e.preventDefault();\r\n\r\n    this.selectedSyntax = syntax;\r\n    this.syntaxChanged.emit(syntax);\r\n    this.currentValue = this.expressions[syntax ? syntax : this.defaultSyntax || SyntaxNames.Literal];\r\n\tif(this.currentValue){\r\n\t\tawait this.expressionEditor.setExpression(this.currentValue);\r\n\t}\r\n\r\n\r\n\r\n    this.closeContextMenu();\r\n  }\r\n\r\n  onSettingsClick(e: Event) {\r\n    this.toggleContextMenu();\r\n  }\r\n\r\n  onExpressionChanged(e: CustomEvent<string>) {\r\n    const expression = e.detail;\r\n\tif(expression){\r\n\t\tthis.expressions[this.selectedSyntax || this.defaultSyntax] = expression;\r\n\t\tthis.expressionChanged.emit(expression);\r\n\t}\r\n  }\r\n\r\n  render() {\r\n    return <div>\r\n      <div class=\"elsa-mb-1\">\r\n        <div class=\"elsa-flex\">\r\n          <div class=\"elsa-flex-1\">\r\n            {this.renderLabel()}\r\n          </div>\r\n          {this.renderContextMenuWidget()}\r\n        </div>\r\n      </div>\r\n      {this.renderEditor()}\r\n    </div>\r\n  }\r\n\r\n  renderLabel() {\r\n    if (!this.label)\r\n      return undefined;\r\n\r\n    const fieldId = this.fieldName;\r\n    const fieldLabel = this.label || fieldId;\r\n\r\n    return <label htmlFor={fieldId} class=\"elsa-block elsa-text-sm elsa-font-medium elsa-text-gray-700\">\r\n      {fieldLabel}\r\n    </label>;\r\n  }\r\n\r\n  renderContextMenuWidget() {\r\n    if (this.supportedSyntaxes.length == 0)\r\n      return undefined;\r\n\r\n    const selectedSyntax = this.selectedSyntax;\r\n    const advancedButtonClass = selectedSyntax ? 'elsa-text-blue-500' : 'elsa-text-gray-300'\r\n\r\n    return <div class=\"elsa-relative\" ref={el => this.contextMenuWidget  = el}>\r\n      <button type=\"button\" class={`elsa-border-0 focus:elsa-outline-none elsa-text-sm ${advancedButtonClass}`} onClick={e => this.onSettingsClick(e)}>\r\n        {!this.isReadOnly ? this.renderContextMenuButton() : \"\"}\r\n      </button>\r\n      <div>\r\n        <div ref={el => this.contextMenu = el}\r\n             data-transition-enter=\"elsa-transition elsa-ease-out elsa-duration-100\"\r\n             data-transition-enter-start=\"elsa-transform elsa-opacity-0 elsa-scale-95\"\r\n             data-transition-enter-end=\"elsa-transform elsa-opacity-100 elsa-scale-100\"\r\n             data-transition-leave=\"elsa-transition elsa-ease-in elsa-duration-75\"\r\n             data-transition-leave-start=\"elsa-transform elsa-opacity-100 elsa-scale-100\"\r\n             data-transition-leave-end=\"elsa-transform elsa-opacity-0 elsa-scale-95\"\r\n             class=\"hidden elsa-origin-top-right elsa-absolute elsa-right-1 elsa-mt-1 elsa-w-56 elsa-rounded-md elsa-shadow-lg elsa-bg-white elsa-ring-1 elsa-ring-black elsa-ring-opacity-5 elsa-divide-y elsa-divide-gray-100 focus:elsa-outline-none elsa-z-10\" role=\"menu\"\r\n             aria-orientation=\"vertical\"\r\n             aria-labelledby=\"options-menu\">\r\n          <div class=\"elsa-py-1\" role=\"none\">\r\n            <a onClick={e => this.selectSyntax(e, null)} href=\"#\" class={`elsa-block elsa-px-4 elsa-py-2 elsa-text-sm hover:elsa-bg-gray-100 hover:elsa-text-gray-900 ${!selectedSyntax ? 'elsa-text-blue-700' : 'elsa-text-gray-700'}`} role=\"menuitem\">Default</a>\r\n          </div>\r\n          <div class=\"elsa-py-1\" role=\"none\">\r\n            {this.supportedSyntaxes.map(syntax => (\r\n              <a onClick={e => this.selectSyntax(e, syntax)} href=\"#\"\r\n                 class={`elsa-block elsa-px-4 elsa-py-2 elsa-text-sm hover:elsa-bg-gray-100 hover:elsa-text-gray-900 ${selectedSyntax == syntax ? 'elsa-text-blue-700' : 'elsa-text-gray-700'}`} role=\"menuitem\">{syntax}</a>\r\n            ))}\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>;\r\n  }\r\n\r\n  renderContextMenuButton() {\r\n    if (!this.selectedSyntax)\r\n      return <svg class=\"elsa-h-5 elsa-w-5 elsa-text-gray-400\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" stroke-width=\"2\" stroke=\"currentColor\" fill=\"none\" stroke-linecap=\"round\" stroke-linejoin=\"round\">\r\n        <path stroke=\"none\" d=\"M0 0h24v24H0z\"/>\r\n        <circle cx=\"12\" cy=\"12\" r=\"9\"/>\r\n        <line x1=\"8\" y1=\"12\" x2=\"8\" y2=\"12.01\"/>\r\n        <line x1=\"12\" y1=\"12\" x2=\"12\" y2=\"12.01\"/>\r\n        <line x1=\"16\" y1=\"12\" x2=\"16\" y2=\"12.01\"/>\r\n      </svg>;\r\n\r\n    return <span>{this.selectedSyntax}</span>;\r\n  }\r\n\r\n  renderEditor() {\r\n    const selectedSyntax = this.selectedSyntax;\r\n    const monacoLanguage = mapSyntaxToLanguage(selectedSyntax);\r\n    const value = this.currentValue;\r\n    const expressionEditorClass = selectedSyntax ? 'block' : 'hidden';\r\n    const defaultEditorClass = selectedSyntax ? 'hidden' : 'block';\r\n\r\n    return (\r\n      <div>\r\n        <div class={expressionEditorClass}>\r\n          <elsa-expression-editor ref={el => this.expressionEditor = el}\r\n                                  onExpressionChanged={e => this.onExpressionChanged(e)}\r\n                                  expression={value}\r\n                                  language={monacoLanguage}\r\n                                  editorHeight={this.editorHeight}\r\n                                  singleLineMode={this.singleLineMode}\r\n                                  context={this.context}/>\r\n        </div>\r\n        <div class={defaultEditorClass}>\r\n          <slot/>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}