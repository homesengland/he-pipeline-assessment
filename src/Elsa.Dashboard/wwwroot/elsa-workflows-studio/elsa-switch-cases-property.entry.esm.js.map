{"version":3,"file":"elsa-switch-cases-property.entry.esm.js","sources":["src/components/editors/properties/elsa-switch-cases-property/elsa-switch-cases-property.tsx"],"sourcesContent":["import {Component, EventEmitter, h, Prop, State, Event} from '@stencil/core';\r\nimport {\r\n  ActivityDefinitionProperty,\r\n  ActivityModel,\r\n  ActivityPropertyDescriptor,\r\n  IntellisenseContext,\r\n  SyntaxNames\r\n} from \"../../../../models\";\r\nimport {mapSyntaxToLanguage, parseJson} from \"../../../../utils/utils\";\r\nimport {SwitchCase} from \"./models\";\r\nimport {IconColor, IconName, iconProvider} from \"../../../../services/icon-provider\";\r\n\r\n@Component({\r\n  tag: 'elsa-switch-cases-property',\r\n  shadow: false,\r\n})\r\nexport class ElsaSwitchCasesProperty {\r\n\r\n  @Prop() activityModel: ActivityModel;\r\n  @Prop() propertyDescriptor: ActivityPropertyDescriptor;\r\n  @Prop() propertyModel: ActivityDefinitionProperty;\r\n  @State() cases: Array<SwitchCase> = [];\r\n  @Event() valueChange: EventEmitter<Array<any>>;\r\n\r\n  supportedSyntaxes: Array<string> = [SyntaxNames.JavaScript, SyntaxNames.Liquid];\r\n  multiExpressionEditor: HTMLElsaMultiExpressionEditorElement;\r\n  syntaxSwitchCount: number = 0;\r\n\r\n  async componentWillLoad() {\r\n    const propertyModel = this.propertyModel;\r\n    const casesJson = propertyModel.expressions['Switch']\r\n    this.cases = parseJson(casesJson) || [];\r\n  }\r\n\r\n  updatePropertyModel() {\r\n    this.propertyModel.expressions['Switch'] = JSON.stringify(this.cases);\r\n    this.multiExpressionEditor.expressions[SyntaxNames.Json] = JSON.stringify(this.cases, null, 2);\r\n  }\r\n\r\n  onDefaultSyntaxValueChanged(e: CustomEvent) {\r\n    this.cases = e.detail;\r\n  }\r\n\r\n  onAddCaseClick() {\r\n    const caseName = `Case ${this.cases.length + 1}`;\r\n    const newCase = {name: caseName, syntax: SyntaxNames.JavaScript, expressions: {[SyntaxNames.JavaScript]: ''}};\r\n    this.cases = [...this.cases, newCase];\r\n    this.updatePropertyModel();\r\n  }\r\n\r\n  onDeleteCaseClick(switchCase: SwitchCase) {\r\n    this.cases = this.cases.filter(x => x != switchCase);\r\n    this.updatePropertyModel();\r\n  }\r\n\r\n  onCaseNameChanged(e: Event, switchCase: SwitchCase) {\r\n    switchCase.name = (e.currentTarget as HTMLInputElement).value.trim();\r\n    this.updatePropertyModel();\r\n  }\r\n\r\n  onCaseExpressionChanged(e: CustomEvent<string>, switchCase: SwitchCase) {\r\n    switchCase.expressions[switchCase.syntax] = e.detail;\r\n    this.updatePropertyModel();\r\n  }\r\n\r\n  onCaseSyntaxChanged(e: Event, switchCase: SwitchCase, expressionEditor: HTMLElsaExpressionEditorElement) {\r\n    const select = e.currentTarget as HTMLSelectElement;\r\n    switchCase.syntax = select.value;\r\n    expressionEditor.language = mapSyntaxToLanguage(switchCase.syntax);\r\n    this.updatePropertyModel();\r\n  }\r\n\r\n  onMultiExpressionEditorValueChanged(e: CustomEvent<string>) {\r\n    const json = e.detail;\r\n    const parsed = parseJson(json);\r\n\r\n    if (!parsed)\r\n      return;\r\n\r\n    if (!Array.isArray(parsed))\r\n      return;\r\n\r\n    this.propertyModel.expressions['Switch'] = json;\r\n    this.cases = parsed;\r\n\r\n  }\r\n\r\n  onMultiExpressionEditorSyntaxChanged(e: CustomEvent<string>) {\r\n    this.syntaxSwitchCount++;\r\n  }\r\n\r\n  render() {\r\n    const cases = this.cases;\r\n    const supportedSyntaxes = this.supportedSyntaxes;\r\n    const json = JSON.stringify(cases, null, 2);\r\n\r\n    const renderCaseEditor = (switchCase: SwitchCase, index: number) => {\r\n      const expression = switchCase.expressions[switchCase.syntax];\r\n      const syntax = switchCase.syntax;\r\n      const monacoLanguage = mapSyntaxToLanguage(syntax);\r\n      let expressionEditor = null;\r\n\r\n      return (\r\n        <tr key={`case-${index}`}>\r\n          <td class=\"elsa-py-2 elsa-pr-5\">\r\n            <input type=\"text\" value={switchCase.name} onChange={e => this.onCaseNameChanged(e, switchCase)}\r\n                   class=\"focus:elsa-ring-blue-500 focus:elsa-border-blue-500 elsa-block elsa-w-full elsa-min-w-0 elsa-rounded-md sm:elsa-text-sm elsa-border-gray-300\"/>\r\n          </td>\r\n          <td class=\"elsa-py-2 pl-5\">\r\n\r\n            <div class=\"elsa-mt-1 elsa-relative elsa-rounded-md elsa-shadow-sm\">\r\n              <elsa-expression-editor\r\n                key={`expression-editor-${index}-${this.syntaxSwitchCount}`}\r\n                ref={el => expressionEditor = el}\r\n                expression={expression}\r\n                language={monacoLanguage}\r\n                single-line={true}\r\n                editorHeight=\"2.75em\"\r\n                padding=\"elsa-pt-1.5 elsa-pl-8 elsa-pr-28\"\r\n                opensModal\r\n                onExpressionChanged={e => this.onCaseExpressionChanged(e, switchCase)}\r\n              />\r\n              <div class=\"elsa-absolute elsa-inset-y-0 elsa-right-0 elsa-flex elsa-items-center\">\r\n                <select onChange={e => this.onCaseSyntaxChanged(e, switchCase, expressionEditor)}\r\n                        class=\"focus:elsa-ring-blue-500 focus:elsa-border-blue-500 elsa-h-full elsa-py-0 elsa-pl-2 elsa-pr-7 elsa-border-transparent elsa-bg-transparent elsa-text-gray-500 sm:elsa-text-sm elsa-rounded-md\">\r\n                  {supportedSyntaxes.map(supportedSyntax => {\r\n                    const selected = supportedSyntax == syntax;\r\n                    return <option selected={selected}>{supportedSyntax}</option>;\r\n                  })}\r\n                </select>\r\n              </div>\r\n            </div>\r\n          </td>\r\n          <td class=\"elsa-pt-1 elsa-pr-2 elsa-text-right\">\r\n            <button type=\"button\" onClick={() => this.onDeleteCaseClick(switchCase)}\r\n                    class=\"elsa-h-5 elsa-w-5 elsa-mx-auto elsa-outline-none focus:elsa-outline-none\">\r\n              { iconProvider.getIcon(IconName.TrashBinOutline) }\r\n            </button>\r\n          </td>\r\n        </tr>\r\n      );\r\n    };\r\n\r\n    const context: IntellisenseContext = {\r\n      activityTypeName: this.activityModel.type,\r\n      propertyName: this.propertyDescriptor.name\r\n    };\r\n\r\n    return (\r\n      <div>\r\n\r\n        <elsa-multi-expression-editor\r\n          ref={el => this.multiExpressionEditor = el}\r\n          label={this.propertyDescriptor.label}\r\n          defaultSyntax={SyntaxNames.Json}\r\n          supportedSyntaxes={[SyntaxNames.Json]}\r\n          context={context}\r\n          expressions={{'Json': json}}\r\n          editor-height=\"20rem\"\r\n          onExpressionChanged={e => this.onMultiExpressionEditorValueChanged(e)}\r\n          onSyntaxChanged={e => this.onMultiExpressionEditorSyntaxChanged(e)}\r\n        >\r\n\r\n          <table class=\"elsa-min-w-full elsa-divide-y elsa-divide-gray-200\">\r\n            <thead class=\"elsa-bg-gray-50\">\r\n            <tr>\r\n              <th\r\n                class=\"elsa-px-6 elsa-py-3 elsa-text-left elsa-text-xs elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-tracking-wider elsa-w-3/12\">Name\r\n              </th>\r\n              <th\r\n                class=\"elsa-px-6 elsa-py-3 elsa-text-left elsa-text-xs elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-tracking-wider elsa-w-8/12\">Expression\r\n              </th>\r\n              <th\r\n                class=\"elsa-px-6 elsa-py-3 elsa-text-left elsa-text-xs elsa-font-medium elsa-text-gray-500 elsa-text-right elsa-tracking-wider elsa-w-1/12\">&nbsp;</th>\r\n            </tr>\r\n            </thead>\r\n            <tbody>\r\n            {cases.map(renderCaseEditor)}\r\n            </tbody>\r\n          </table>\r\n          <button type=\"button\" onClick={() => this.onAddCaseClick()}\r\n                  class=\"elsa-inline-flex elsa-items-center elsa-px-4 elsa-py-2 elsa-border elsa-border-transparent elsa-shadow-sm elsa-text-sm elsa-font-medium elsa-rounded-md elsa-text-white elsa-bg-blue-600 hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 elsa-mt-2\">\r\n            { iconProvider.getIcon(IconName.Plus) }\r\n            Add Case\r\n          </button>\r\n        </elsa-multi-expression-editor>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}