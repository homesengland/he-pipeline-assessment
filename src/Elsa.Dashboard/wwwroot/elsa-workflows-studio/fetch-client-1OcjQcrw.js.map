{"version":3,"file":"fetch-client-1OcjQcrw.js","sources":["src/services/http/fetch-client.ts"],"sourcesContent":["import { eventBus } from '../event-bus';\nimport { EventTypes } from '../../models/events';\n\n// Minimal Axios-like response type.\nexport interface HttpResponse<T = any> {\n  status: number;\n  headers: Record<string, string>;\n  data: T;\n}\n\nexport interface HttpRequestConfig {\n  baseURL?: string;\n  method?: string;\n  url?: string;\n  headers?: Record<string, string>;\n  body?: any; // Will be string | FormData\n  responseType?: 'blob' | 'json' | 'text';\n}\n\nexport interface Interceptor {\n  onRequest?(config: HttpRequestConfig): Promise<HttpRequestConfig> | HttpRequestConfig;\n  onResponse?<T = any>(response: HttpResponse<T>, request: HttpRequestConfig): Promise<HttpResponse<T>> | HttpResponse<T>;\n  onError?(error: any, request: HttpRequestConfig): Promise<any> | any;\n}\n\nexport interface HttpClient {\n  get<T = any>(url: string, config?: Omit<HttpRequestConfig, 'url' | 'method'>): Promise<HttpResponse<T>>;\n  post<T = any>(url: string, body?: any, config?: Omit<HttpRequestConfig, 'url' | 'method'>): Promise<HttpResponse<T>>;\n  put<T = any>(url: string, body?: any, config?: Omit<HttpRequestConfig, 'url' | 'method'>): Promise<HttpResponse<T>>;\n  delete<T = any>(url: string, config?: Omit<HttpRequestConfig, 'url' | 'method'>): Promise<HttpResponse<T>>;\n  use(interceptor: Interceptor): void;\n  baseURL(): string;\n}\n\nclass FetchClient implements HttpClient {\n  private readonly _baseURL: string;\n  private interceptors: Interceptor[] = [];\n\n  constructor(baseURL: string) {\n    this._baseURL = baseURL;\n  }\n\n  use(interceptor: Interceptor) {\n    this.interceptors.push(interceptor);\n  }\n\n  baseURL() { return this._baseURL; }\n\n  async get<T>(url: string, config: Omit<HttpRequestConfig, 'url' | 'method'> = {}): Promise<HttpResponse<T>> {\n    return this.request<T>({ ...config, method: 'GET', url });\n  }\n  async post<T>(url: string, body?: any, config: Omit<HttpRequestConfig, 'url' | 'method'> = {}): Promise<HttpResponse<T>> {\n    return this.request<T>({ ...config, method: 'POST', url, body });\n  }\n  async put<T>(url: string, body?: any, config: Omit<HttpRequestConfig, 'url' | 'method'> = {}): Promise<HttpResponse<T>> {\n    return this.request<T>({ ...config, method: 'PUT', url, body });\n  }\n  async delete<T>(url: string, config: Omit<HttpRequestConfig, 'url' | 'method'> = {}): Promise<HttpResponse<T>> {\n    return this.request<T>({ ...config, method: 'DELETE', url });\n  }\n\n  private async request<T>(initialConfig: HttpRequestConfig): Promise<HttpResponse<T>> {\n    let config: HttpRequestConfig = { ...initialConfig };\n\n    // Resolve base URL.\n    const fullUrl = this._baseURL ? combineUrl(this._baseURL, config.url || '') : (config.url || '');\n    config.url = fullUrl;\n\n    // Apply request interceptors sequentially.\n    for (const i of this.interceptors) {\n      if (i.onRequest) {\n        config = await i.onRequest(config);\n      }\n    }\n\n    const fetchInit: RequestInit = {\n      method: config.method,\n      headers: config.headers,\n      body: needsBody(config.method) ? serializeBody(config.body, config.headers) : undefined,\n    };\n\n    let response: Response;\n    try {\n      response = await fetch(fullUrl, fetchInit);\n    } catch (err) {\n      for (const i of this.interceptors) {\n        if (i.onError) await i.onError(err, config);\n      }\n      throw err;\n    }\n\n    const respHeaders: Record<string, string> = {};\n    response.headers.forEach((v, k) => respHeaders[k.toLowerCase()] = v);\n\n    const contentType = respHeaders['content-type'] || '';\n    let data: any;\n    if (config.responseType === 'blob') {\n      data = await response.blob();\n    } else if (config.responseType === 'text') {\n      data = await response.text();\n    } else if (config.responseType === 'json') {\n      data = await safeJson(response);\n    } else if (contentType.includes('application/json')) {\n      data = await safeJson(response);\n    } else if (contentType.includes('text/')) {\n      data = await response.text();\n    } else if (contentType.includes('application/octet-stream') || contentType.includes('application/zip')) {\n      data = await response.blob();\n    } else {\n      data = await response.text(); // fallback\n    }\n\n    let httpResponse: HttpResponse<T> = { status: response.status, headers: respHeaders, data };\n\n    for (const i of this.interceptors) {\n      if (i.onResponse) {\n        httpResponse = await i.onResponse(httpResponse, config);\n      }\n    }\n\n    if (!response.ok) {\n      const error = new Error(`HTTP ${response.status} for ${config.method} ${fullUrl}`);\n      for (const i of this.interceptors) {\n        if (i.onError) await i.onError(error, config);\n      }\n      throw error;\n    }\n\n    return httpResponse;\n  }\n}\n\nfunction needsBody(method?: string) {\n  return method === 'POST' || method === 'PUT' || method === 'PATCH';\n}\n\nfunction serializeBody(body: any, headers?: Record<string, string>) {\n  if (!body) return undefined;\n  if (typeof FormData !== 'undefined' && body instanceof FormData) return body;\n  const contentType = headers && Object.keys(headers).find(h => h.toLowerCase() === 'content-type');\n  if (contentType && headers![contentType].includes('application/json'))\n    return typeof body === 'string' ? body : JSON.stringify(body);\n  return body; // send as-is\n}\n\nfunction combineUrl(base: string, path: string) {\n  if (!base) return path;\n  if (base.endsWith('/') && path.startsWith('/')) return base + path.substring(1);\n  if (!base.endsWith('/') && !path.startsWith('/')) return base + '/' + path;\n  return base + path;\n}\n\n// Factory similar to previous createHttpClient.\nexport async function createFetchHttpClient(baseAddress: string): Promise<HttpClient> {\n  const config: HttpRequestConfig = { baseURL: baseAddress };\n  await eventBus.emit(EventTypes.HttpClientConfigCreated, this, { config });\n  const client = new FetchClient(baseAddress);\n  // Compatibility service wrapper emulating axios-middleware Service.register\n  const service = {\n    register(interceptor: Interceptor) {\n      client.use(interceptor);\n    }\n  };\n  await eventBus.emit(EventTypes.HttpClientCreated, this, { service, httpClient: client });\n  return client;\n}\n\nasync function safeJson(response: Response) {\n  try {\n    return await response.json();\n  } catch (_) {\n    return null;\n  }\n}\n\n"],"names":[],"mappings":"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"}