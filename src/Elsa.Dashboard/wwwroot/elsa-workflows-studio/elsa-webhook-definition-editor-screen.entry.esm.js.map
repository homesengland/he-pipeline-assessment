{"version":3,"file":"elsa-webhook-definition-editor-screen.entry.esm.js","sources":["src/modules/elsa-webhooks/components/screens/webhook-definition-editor/elsa-webhook-definition-editor-screen/elsa-webhook-definition-editor-screen.tsx"],"sourcesContent":["import {Component, Event, h, Host, Method, Prop, State, Watch} from '@stencil/core';\nimport {eventBus} from '../../../../../../services/event-bus';\nimport {EventTypes, WebhookDefinition} from \"../../../../models\";\nimport {createElsaWebhooksClient, SaveWebhookDefinitionRequest} from \"../../../../services/elsa-client\";\nimport {RouterHistory} from '@stencil-community/router';\nimport {checkBox, FormContext, textArea, textInput} from \"../../../../../../utils/forms\";\nimport Tunnel from \"../../../../../../data/dashboard\";\n\n@Component({\n  tag: 'elsa-webhook-definition-editor-screen',\n  shadow: false,\n})\nexport class ElsaWebhookDefinitionEditorScreen {\n\n  @Prop() webhookDefinition: WebhookDefinition;\n  @Prop({attribute: 'webhook-definition-id', reflect: true}) webhookId: string;\n  @Prop({attribute: 'server-url', reflect: true}) serverUrl: string;\n  @Prop() culture: string;\n  @Prop() history?: RouterHistory;\n  @State() webhookDefinitionInternal: WebhookDefinition;\n  @State() saving: boolean;\n  @State() saved: boolean;\n  @State() networkError: string;\n  formContext: FormContext;\n  el: HTMLElement;\n\n  @Method()\n  async getServerUrl(): Promise<string> {\n    return this.serverUrl;\n  }\n\n  @Method()\n  async getWebhookId(): Promise<string> {\n    return this.webhookDefinitionInternal.id;\n  }\n\n  @Watch('webhookDefinition')\n  async webhookDefinitionChangedHandler(newValue: WebhookDefinition) {\n\n\n    this.webhookDefinitionInternal = {...newValue};\n    this.formContext = new FormContext(this.webhookDefinitionInternal, newValue => this.webhookDefinitionInternal = newValue);\n  }\n\n  @Watch('webhookId')\n  async webhookIdChangedHandler(newValue: string) {\n\n    const webhookId = newValue;\n    let webhookDefinition: WebhookDefinition = ElsaWebhookDefinitionEditorScreen.createWebhookDefinition();\n    webhookDefinition.id = webhookId;\n  const client = await createElsaWebhooksClient(this.serverUrl);\n\n    if (webhookId && webhookId.length > 0) {\n      try {\n        webhookDefinition = await client.webhookDefinitionsApi.getByWebhookId(webhookId);\n      } catch {\n        console.warn(`The specified webhook definition does not exist. Creating a new one.`)\n      }\n    }\n    else\n    {\n      webhookDefinition.isEnabled = true;\n    }\n\n    this.updateWebhookDefinition(webhookDefinition);\n  }\n\n  @Watch(\"serverUrl\")\n  async serverUrlChangedHandler(newValue: string) {\n  }\n\n  async componentWillLoad() {\n    await this.serverUrlChangedHandler(this.serverUrl);\n    await this.webhookDefinitionChangedHandler(this.webhookDefinition);\n    await this.webhookIdChangedHandler(this.webhookId);\n  }\n\n  async saveWebhook() {\n\n    if (!this.serverUrl || this.serverUrl.length == 0)\n      return;\n\n  const client = await createElsaWebhooksClient(this.serverUrl);\n\n    let webhookDefinition = this.webhookDefinitionInternal;\n\n    const request: SaveWebhookDefinitionRequest = {\n      id: webhookDefinition.id || this.webhookId,\n      name: webhookDefinition.name,\n      path: webhookDefinition.path,\n      description: webhookDefinition.description,\n      payloadTypeName: webhookDefinition.payloadTypeName,\n      isEnabled: webhookDefinition.isEnabled,\n    };\n\n    this.saving = true;\n\n    try {\n      if (request.id == null)\n        webhookDefinition = await client.webhookDefinitionsApi.save(request);\n      else\n        webhookDefinition = await client.webhookDefinitionsApi.update(request);\n\n      this.saving = false;\n      this.saved = true;\n      setTimeout(() => this.saved = false, 500);\n    }\n    catch (e) {\n      console.error(e);\n      this.saving = false;\n      this.saved = false;\n      this.networkError = e.message;\n      setTimeout(() => this.networkError = null, 10000);\n    }\n  }\n\n  updateWebhookDefinition(value: WebhookDefinition) {\n    this.webhookDefinition = value;\n  }\n\n  sleep(ms) {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  navigate(path: string) {\n    if (this.history) {\n        this.history.push(path);\n        return;\n    }\n\n    document.location.pathname = path;\n  }\n\n  async onSaveClicked(e: Event) {\n    e.preventDefault();\n\n    await this.saveWebhook();\n    eventBus.emit(EventTypes.WebhookSaved, this, this.webhookDefinitionInternal);\n\n    const anchor = e.currentTarget as HTMLAnchorElement;\n\n    this.sleep(1000).then(() => {\n      this.navigate(`/webhook-definitions`);\n    });\n  }\n\n  render() {\n\n    return (\n      <Host class=\"elsa-flex elsa-flex-col elsa-w-full\" ref={el => this.el = el}>\n\n          <form onSubmit={e => this.onSaveClicked(e)}>\n            <div class=\"elsa-px-8 mb-8\">\n              <div class=\"elsa-border-b elsa-border-gray-200\">\n              </div>\n            </div>\n\n            {this.renderWebhookFields()}\n            {this.renderCanvas()}\n\n          </form>\n\n      </Host>\n    );\n  }\n\n  renderWebhookFields() {\n\n    const webhookDefinition = this.webhookDefinitionInternal;\n    const formContext = this.formContext;\n\n    return (\n\n      <main class=\"elsa-max-w-7xl elsa-mx-auto elsa-pb-10 lg:elsa-py-12 lg:elsa-px-8\">\n        <div class=\"lg:elsa-grid lg:elsa-grid-cols-12 lg:elsa-gap-x-5\">\n\n          <aside class=\"elsa-py-6 elsa-px-2 sm:elsa-px-6 lg:elsa-py-0 lg:elsa-px-0 lg:elsa-col-span-2\">\n          </aside>\n\n            <div class=\"elsa-space-y-6 sm:elsa-px-6 lg:elsa-px-0 lg:elsa-col-span-9\">\n            <section aria-labelledby=\"payment_details_heading\">\n              <div class=\"elsa-shadow sm:elsa-rounded-md sm:elsa-overflow-hidden\">\n                <div class=\"elsa-bg-white elsa-py-6 elsa-px-4 sm:elsa-p-6\">\n                  <div>\n                    <h1 class=\"elsa-text-lg elsa-leading-6 elsa-font-medium elsa-text-gray-900\">\n                      { null == webhookDefinition.id ? \"Create Webhook Definition\" : \"Edit Webhook Definition\" }\n                    </h1>\n                  </div>\n\n                  <div class=\"elsa-mt-6 elsa-grid elsa-grid-cols-4 elsa-gap-6\">\n                    <div class=\"elsa-col-span-4\">\n                      {textInput(formContext, 'name', 'Name', webhookDefinition.name, 'The name of the webhook.', 'webhookName')}\n                    </div>\n\n                    <div class=\"elsa-col-span-4\">\n                      {textInput(formContext, 'path', 'Path', webhookDefinition.path, 'The path of the webhook.', 'webhookPath')}\n                    </div>\n\n                    <div class=\"elsa-col-span-4\">\n                      {textArea(formContext, 'description', 'Description', webhookDefinition.description, null, 'webhookDescription')}\n                    </div>\n\n                    <div class=\"elsa-col-span-4\">\n                      {textInput(formContext, 'payloadTypeName', 'Payload Type Name', webhookDefinition.payloadTypeName, 'The payload type name of the webhook.', 'webhookPayloadTypeName')}\n                    </div>\n\n                    <div class=\"elsa-col-span-4\">\n                      {checkBox(formContext, 'isEnabled', 'Enabled', webhookDefinition.isEnabled, null)}\n                    </div>\n                  </div>\n                </div>\n\n                <div class=\"elsa-px-4 elsa-py-3 elsa-bg-gray-50 elsa-text-right sm:px-6\">\n                    <button type=\"submit\"\n                            class=\"elsa-ml-0 elsa-w-full elsa-inline-flex elsa-justify-center elsa-rounded-md elsa-border elsa-border-transparent elsa-shadow-sm elsa-px-4 elsa-py-2 elsa-bg-blue-600 elsa-text-base elsa-font-medium elsa-text-white hover:elsa-bg-blue-700 focus:elsa-outline-none focus:elsa-ring-2 focus:elsa-ring-offset-2 focus:elsa-ring-blue-500 sm:elsa-ml-3 sm:elsa-w-auto sm:elsa-text-sm\">\n                      Save\n                    </button>\n                </div>\n\n              </div>\n            </section>\n          </div>\n        </div>\n      </main>\n\n    );\n  }\n\n  renderCanvas() {\n\n    return (\n      <div class=\"elsa-flex-1 elsa-flex elsa-relative\">\n        <elsa-webhook-definition-editor-notifications/>\n        <div class=\"elsa-fixed elsa-bottom-10 elsa-right-12\">\n          <div class=\"elsa-flex elsa-items-center elsa-space-x-4\">\n            {this.renderSavingIndicator()}\n            {this.renderNetworkError()}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  renderSavingIndicator() {\n\n    const message =\n      this.saving ? 'Saving...' : this.saved ? 'Saved'\n        : null;\n\n    if (!message)\n      return undefined;\n\n    return (\n      <div>\n        <span class=\"elsa-text-gray-400 elsa-text-sm\">{message}</span>\n      </div>\n    );\n  }\n\n  renderNetworkError() {\n    if (!this.networkError)\n      return undefined;\n\n    return (\n      <div>\n        <span class=\"elsa-text-rose-400 elsa-text-sm\">An error occurred: {this.networkError}</span>\n      </div>);\n  }\n\n  private static createWebhookDefinition(): WebhookDefinition {\n    return {\n      id: null,\n    };\n  }\n}\nTunnel.injectProps(ElsaWebhookDefinitionEditorScreen, ['serverUrl', 'culture']);\n"],"names":[],"mappings":"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"}