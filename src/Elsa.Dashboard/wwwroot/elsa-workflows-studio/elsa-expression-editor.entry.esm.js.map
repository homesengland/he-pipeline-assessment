{"version":3,"file":"elsa-expression-editor.entry.esm.js","sources":["src/components/editors/elsa-expression-editor/elsa-expression-editor.tsx"],"sourcesContent":["import { Component, EventEmitter, h, Method, Prop, State, Watch, Event } from '@stencil/core';\r\nimport { createElsaClient } from '../../../services';\r\nimport Tunnel from '../../../data/workflow-editor';\r\nimport { MonacoValueChangedArgs } from '../../controls/elsa-monaco/elsa-monaco';\r\nimport { IntellisenseContext } from '../../../models';\r\nimport { monacoEditorDialogService } from '../../../services/monaco-editor-dialog-service';\r\nimport { IconName, iconProvider } from '../../../services/icon-provider';\r\n\r\n@Component({\r\n  tag: 'elsa-expression-editor',\r\n  shadow: false,\r\n})\r\nexport class ElsaExpressionEditor {\r\n  @Event() expressionChanged: EventEmitter<string>;\r\n  @Prop() opensModal: boolean = false;\r\n  @Prop() language: string;\r\n  @Prop() expression: string;\r\n  @Prop({ attribute: 'editor-height', reflect: true }) editorHeight: string = '6em';\r\n  @Prop({ attribute: 'single-line', reflect: true }) singleLineMode: boolean = false;\r\n  @Prop() padding: string;\r\n  @Prop() context?: IntellisenseContext;\r\n  @Prop({ mutable: true }) serverUrl: string;\r\n  @Prop({ mutable: true }) workflowDefinitionId: string;\r\n  @State() currentExpression?: string;\r\n\r\n  monacoEditor: HTMLElsaMonacoElement;\r\n\r\n  @Watch('expression')\r\n  expressionChangedHandler(newValue: string) {\r\n    this.currentExpression = newValue;\r\n  }\r\n\r\n  @Method()\r\n  async setExpression(value: string) {\r\n    await this.monacoEditor.setValue(value);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    this.currentExpression = this.expression;\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    const elsaClient = await createElsaClient(this.serverUrl);\r\n    const libSource = await elsaClient.scriptingApi.getJavaScriptTypeDefinitions(this.workflowDefinitionId, this.context);\r\n    const libUri = 'defaultLib:lib.es6.d.ts';\r\n    await this.monacoEditor.addJavaScriptLib(libSource, libUri);\r\n    if (monacoEditorDialogService.monacoEditor) {\r\n      monacoEditorDialogService.monacoEditor.addJavaScriptLib(libSource, libUri);\r\n    }\r\n  }\r\n\r\n  async onMonacoValueChanged(e: MonacoValueChangedArgs) {\r\n    this.currentExpression = e.value;\r\n    await this.expressionChanged.emit(e.value);\r\n  }\r\n\r\n  onEditorClick = e => {\r\n    e.preventDefault();\r\n    monacoEditorDialogService.show(this.language, this.currentExpression, (val: string) => this.setExpression(val));\r\n  };\r\n\r\n  render() {\r\n    const language = this.language;\r\n    const value = this.currentExpression;\r\n\r\n    return (\r\n      <elsa-monaco\r\n        value={value}\r\n        language={language}\r\n        editor-height={this.editorHeight}\r\n        single-line={this.singleLineMode}\r\n        padding={this.padding}\r\n        onValueChanged={e => this.onMonacoValueChanged(e.detail)}\r\n        ref={el => (this.monacoEditor = el)}\r\n      >\r\n        {this.opensModal &&\r\n          <button\r\n            class=\"elsa-absolute elsa-z-10\"\r\n            style={{ left: \"0.25rem\", top: \"0.35rem\" }}\r\n            onClick={this.onEditorClick}\r\n            >\r\n            { iconProvider.getIcon(IconName.OpenInDialog) }\r\n          </button>\r\n        }\r\n      </elsa-monaco>\r\n    );\r\n  }\r\n}\r\n\r\nTunnel.injectProps(ElsaExpressionEditor, ['serverUrl', 'workflowDefinitionId']);\r\n"],"names":[],"mappings":";;;;;;;;;;;;;;;MAYa,oBAAoB,GAAA,MAAA;AAJjC,IAAA,WAAA,CAAA,OAAA,EAAA;;;AAMU,QAAA,IAAU,CAAA,UAAA,GAAY,KAAK;AAGkB,QAAA,IAAY,CAAA,YAAA,GAAW,KAAK;AAC9B,QAAA,IAAc,CAAA,cAAA,GAAY,KAAK;AAsClF,QAAA,IAAa,CAAA,aAAA,GAAG,CAAC,IAAG;YAClB,CAAC,CAAC,cAAc,EAAE;YAClB,yBAAyB,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,iBAAiB,EAAE,CAAC,GAAW,KAAK,IAAI,CAAC,aAAa,CAAC,GAAG,CAAC,CAAC;AACjH,SAAC;AA4BF;AA3DC,IAAA,wBAAwB,CAAC,QAAgB,EAAA;AACvC,QAAA,IAAI,CAAC,iBAAiB,GAAG,QAAQ;;IAInC,MAAM,aAAa,CAAC,KAAa,EAAA;QAC/B,MAAM,IAAI,CAAC,YAAY,CAAC,QAAQ,CAAC,KAAK,CAAC;;AAGzC,IAAA,MAAM,iBAAiB,GAAA;AACrB,QAAA,IAAI,CAAC,iBAAiB,GAAG,IAAI,CAAC,UAAU;;AAG1C,IAAA,MAAM,gBAAgB,GAAA;QACpB,MAAM,UAAU,GAAG,MAAM,gBAAgB,CAAC,IAAI,CAAC,SAAS,CAAC;AACzD,QAAA,MAAM,SAAS,GAAG,MAAM,UAAU,CAAC,YAAY,CAAC,4BAA4B,CAAC,IAAI,CAAC,oBAAoB,EAAE,IAAI,CAAC,OAAO,CAAC;QACrH,MAAM,MAAM,GAAG,yBAAyB;QACxC,MAAM,IAAI,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAM,CAAC;AAC3D,QAAA,IAAI,yBAAyB,CAAC,YAAY,EAAE;YAC1C,yBAAyB,CAAC,YAAY,CAAC,gBAAgB,CAAC,SAAS,EAAE,MAAM,CAAC;;;IAI9E,MAAM,oBAAoB,CAAC,CAAyB,EAAA;AAClD,QAAA,IAAI,CAAC,iBAAiB,GAAG,CAAC,CAAC,KAAK;QAChC,MAAM,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC,CAAC,KAAK,CAAC;;IAQ5C,MAAM,GAAA;AACJ,QAAA,MAAM,QAAQ,GAAG,IAAI,CAAC,QAAQ;AAC9B,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,iBAAiB;AAEpC,QAAA,QACE,CACE,CAAA,aAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EAAA,KAAK,EAAE,KAAK,EACZ,QAAQ,EAAE,QAAQ,EAAA,eAAA,EACH,IAAI,CAAC,YAAY,EACnB,aAAA,EAAA,IAAI,CAAC,cAAc,EAChC,OAAO,EAAE,IAAI,CAAC,OAAO,EACrB,cAAc,EAAE,CAAC,IAAI,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC,MAAM,CAAC,EACxD,GAAG,EAAE,EAAE,KAAK,IAAI,CAAC,YAAY,GAAG,EAAE,CAAC,EAAA,EAElC,IAAI,CAAC,UAAU;AACd,YAAA,CAAA,CAAA,QAAA,EAAA,EAAA,GAAA,EAAA,0CAAA,EACE,KAAK,EAAC,yBAAyB,EAC/B,KAAK,EAAE,EAAE,IAAI,EAAE,SAAS,EAAE,GAAG,EAAE,SAAS,EAAE,EAC1C,OAAO,EAAE,IAAI,CAAC,aAAa,EAAA,EAEzB,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,YAAY,CAAC,CACtC,CAEC;;;;;;AAKpB,MAAM,CAAC,WAAW,CAAC,oBAAoB,EAAE,CAAC,WAAW,EAAE,sBAAsB,CAAC,CAAC;;;;"}