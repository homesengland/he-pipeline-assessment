{"version":3,"file":"elsa-studio-root.entry.esm.js","sources":["src/components/dashboard/pages/elsa-studio-root/elsa-studio-root.tsx"],"sourcesContent":["import {Component, Event, EventEmitter, h, Listen, Method, Prop, State} from '@stencil/core';\r\nimport Tunnel, {DashboardState} from \"../../../../data/dashboard\";\r\nimport {ElsaStudio, WorkflowModel} from \"../../../../models\";\r\nimport {\r\n  eventBus,\r\n  pluginManager,\r\n  activityIconProvider,\r\n  confirmDialogService,\r\n  toastNotificationService,\r\n  createElsaClient,\r\n  createHttpClient,\r\n  ElsaClient,\r\n  propertyDisplayManager,\r\n  featuresDataManager\r\n} from \"../../../../services\";\r\nimport {AxiosInstance} from \"axios\";\r\nimport {EventTypes} from \"../../../../models\";\r\nimport {ToastNotificationOptions} from \"../../../shared/elsa-toast-notification/elsa-toast-notification\";\r\nimport {getOrCreateProperty, htmlToElement} from \"../../../../utils/utils\";\r\nimport state from '../../../../utils/store';\r\n\r\n@Component({\r\n  tag: 'elsa-studio-root',\r\n  shadow: false\r\n})\r\nexport class ElsaStudioRoot {\r\n\r\n  @Prop({attribute: 'server-url', reflect: true}) serverUrl: string;\r\n  @Prop({attribute: 'monaco-lib-path', reflect: true}) monacoLibPath: string;\r\n  @Prop({attribute: 'culture', reflect: true}) culture: string;\r\n  @Prop({attribute: 'base-path', reflect: true}) basePath: string = '';\r\n  @Prop({attribute: 'use-x6-graphs', reflect: true}) useX6Graphs: boolean = false;\r\n  @Prop() features: any;\r\n  @Prop() config: string;\r\n  @State() featuresConfig: any;\r\n  @Event() initializing: EventEmitter<ElsaStudio>;\r\n  @Event() initialized: EventEmitter<ElsaStudio>;\r\n\r\n  private confirmDialog: HTMLElsaConfirmDialogElement;\r\n  private toastNotificationElement: HTMLElsaToastNotificationElement;\r\n  private elsaStudio: ElsaStudio;\r\n\r\n  @Method()\r\n  async addPlugins(pluginTypes: Array<any>) {\r\n    pluginManager.registerPlugins(pluginTypes);\r\n  }\r\n\r\n  @Method()\r\n  async addPlugin(pluginType: any) {\r\n    pluginManager.registerPlugin(pluginType);\r\n  }\r\n\r\n  @Listen('workflow-changed')\r\n  workflowChangedHandler(event: CustomEvent<WorkflowModel>) {\r\n    eventBus.emit(EventTypes.WorkflowModelChanged, this, event.detail);\r\n  }\r\n\r\n  connectedCallback() {\r\n    eventBus.on(EventTypes.ShowConfirmDialog, this.onShowConfirmDialog);\r\n    eventBus.on(EventTypes.HideConfirmDialog, this.onHideConfirmDialog);\r\n    eventBus.on(EventTypes.ShowToastNotification, this.onShowToastNotification);\r\n    eventBus.on(EventTypes.HideToastNotification, this.onHideToastNotification);\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    eventBus.detach(EventTypes.ShowConfirmDialog, this.onShowConfirmDialog);\r\n    eventBus.detach(EventTypes.HideConfirmDialog, this.onHideConfirmDialog);\r\n    eventBus.detach(EventTypes.ShowToastNotification, this.onShowToastNotification);\r\n    eventBus.detach(EventTypes.HideToastNotification, this.onHideToastNotification);\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    state.useX6Graphs = this.useX6Graphs;\r\n\r\n    const elsaClientFactory: () => Promise<ElsaClient> = () => createElsaClient(this.serverUrl);\r\n    const httpClientFactory: () => Promise<AxiosInstance> = () => createHttpClient(this.serverUrl);\r\n\r\n    if (this.config) {\r\n      await fetch(`${document.location.origin}/${this.config}`)\r\n        .then(response => {\r\n          if (!response.ok) {\r\n            throw new Error(\"HTTP error \" + response.status);\r\n          }\r\n\r\n          return response.json()\r\n        })\r\n        .then(data => {\r\n          this.featuresConfig = data;\r\n        }).catch((error) => {\r\n          console.error(error)\r\n        });\r\n    }\r\n\r\n    const elsaStudio: ElsaStudio = this.elsaStudio = {\r\n      serverUrl: this.serverUrl,\r\n      basePath: this.basePath,\r\n      features: this.featuresConfig,\r\n      serverFeatures: [],\r\n      serverVersion: null,\r\n      eventBus,\r\n      pluginManager,\r\n      propertyDisplayManager,\r\n      activityIconProvider,\r\n      confirmDialogService,\r\n      toastNotificationService,\r\n      elsaClientFactory,\r\n      httpClientFactory,\r\n      getOrCreateProperty: getOrCreateProperty,\r\n      htmlToElement\r\n    };\r\n\r\n    this.initializing.emit(elsaStudio);\r\n    pluginManager.initialize(elsaStudio);\r\n    await eventBus.emit(EventTypes.Root.Initializing);\r\n    propertyDisplayManager.initialize(elsaStudio);\r\n    featuresDataManager.initialize(elsaStudio);\r\n\r\n    const elsaClient = await elsaClientFactory();\r\n    elsaStudio.serverFeatures = await elsaClient.featuresApi.list();\r\n    elsaStudio.serverVersion = await elsaClient.versionApi.get();\r\n  }\r\n\r\n  async componentDidLoad() {\r\n    this.initialized.emit(this.elsaStudio);\r\n    await eventBus.emit(EventTypes.Root.Initialized);\r\n  }\r\n\r\n  onShowConfirmDialog = (e) => e.promise = this.confirmDialog.show(e.caption, e.message)\r\n  onHideConfirmDialog = async () => await this.confirmDialog.hide()\r\n  onShowToastNotification = async (e: ToastNotificationOptions) => await this.toastNotificationElement.show(e)\r\n  onHideToastNotification = async () => await this.toastNotificationElement.hide()\r\n\r\n  render() {\r\n\r\n    const culture = this.culture;\r\n\r\n    const tunnelState: DashboardState = {\r\n      serverUrl: this.serverUrl,\r\n      basePath: this.basePath,\r\n      serverFeatures: this.elsaStudio.serverFeatures,\r\n      serverVersion: this.elsaStudio.serverVersion,\r\n      culture,\r\n      monacoLibPath: this.monacoLibPath\r\n    };\r\n\r\n    return (\r\n      <Tunnel.Provider state={tunnelState}>\r\n        <slot/>\r\n        <elsa-confirm-dialog ref={el => this.confirmDialog = el} culture={this.culture}/>\r\n        <elsa-toast-notification ref={el => this.toastNotificationElement = el}/>\r\n      </Tunnel.Provider>\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}