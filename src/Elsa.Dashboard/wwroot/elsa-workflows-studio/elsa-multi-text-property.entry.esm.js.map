{"version":3,"file":"elsa-multi-text-property.entry.esm.js","sources":["src/components/editors/properties/elsa-multi-text-property/elsa-multi-text-property.tsx"],"sourcesContent":["import {Component, h, Prop, State, Event, EventEmitter} from '@stencil/core';\r\nimport {\r\n  ActivityDefinitionProperty,\r\n  ActivityPropertyDescriptor,\r\n  SyntaxNames,\r\n  SelectListItem,\r\n  SelectList, ActivityModel, EventTypes\r\n} from \"../../../../models\";\r\nimport {parseJson} from \"../../../../utils/utils\";\r\nimport Tunnel from \"../../../../data/workflow-editor\";\r\nimport {getSelectListItems} from \"../../../../utils/select-list-items\";\r\n\r\n@Component({\r\n  tag: 'elsa-multi-text-property',\r\n  shadow: false,\r\n})\r\nexport class ElsaMultiTextProperty {\r\n\r\n  @Prop() activityModel: ActivityModel;\r\n  @Prop() propertyDescriptor: ActivityPropertyDescriptor;\r\n  @Prop() propertyModel: ActivityDefinitionProperty;\r\n  @Prop({mutable: true}) serverUrl: string;\r\n  @State() currentValue?: string;\r\n  @Event() valueChange: EventEmitter<Array<string | number | boolean | SelectListItem>>;\r\n\r\n  selectList: SelectList = {items: [], isFlagsEnum: false};\r\n\r\n  async componentWillLoad() {\r\n    this.currentValue = this.propertyModel.expressions[SyntaxNames.Json] || '[]';\r\n  }\r\n\r\n  onValueChanged(newValue: Array<string | number | boolean | SelectListItem>) {\r\n    const newValues = newValue.map(item => {\r\n      if (typeof item === 'string') return item;\r\n      if (typeof item === 'number') return item.toString();\r\n      if (typeof item === 'boolean') return item.toString();\r\n\r\n      return item.value;\r\n    })\r\n\r\n    this.valueChange.emit(newValue);\r\n    this.currentValue = JSON.stringify(newValues);\r\n    this.propertyModel.expressions[SyntaxNames.Json] = this.currentValue;\r\n  }\r\n\r\n  onDefaultSyntaxValueChanged(e: CustomEvent) {\r\n    this.currentValue = e.detail;\r\n  }\r\n\r\n  createKeyValueOptions(options: Array<SelectListItem>) {\r\n    if (options === null)\r\n      return options;\r\n\r\n    return options.map(option => typeof option === 'string' ? {text: option, value: option} : option);\r\n  }\r\n\r\n  async componentWillRender() {\r\n    this.selectList = await getSelectListItems(this.serverUrl, this.propertyDescriptor);\r\n  }\r\n\r\n  render() {\r\n    const propertyDescriptor = this.propertyDescriptor;\r\n    const propertyModel = this.propertyModel;\r\n    const propertyName = propertyDescriptor.name;\r\n    const fieldId = propertyName;\r\n    const fieldName = propertyName;\r\n    const values = parseJson(this.currentValue);\r\n    const items = this.selectList.items as Array<SelectListItem>;\r\n    const useDropdown = !!propertyDescriptor.options && Array.isArray(propertyDescriptor.options) && propertyDescriptor.options.length > 0;\r\n    const propertyOptions = this.createKeyValueOptions(items);\r\n\r\n    const elsaInputTags = useDropdown ?\r\n      <elsa-input-tags-dropdown dropdownValues={propertyOptions} values={values} fieldId={fieldId} fieldName={fieldName}\r\n                                onValueChanged={e => this.onValueChanged(e.detail)}/> :\r\n      <elsa-input-tags values={values} fieldId={fieldId} fieldName={fieldName}\r\n                       onValueChanged={e => this.onValueChanged(e.detail)}/>;\r\n\r\n    return (\r\n      <elsa-property-editor\r\n        activityModel={this.activityModel}\r\n        propertyDescriptor={propertyDescriptor}\r\n        propertyModel={propertyModel}\r\n        onDefaultSyntaxValueChanged={e => this.onDefaultSyntaxValueChanged(e)}\r\n        single-line={true}>\r\n        {elsaInputTags}\r\n      </elsa-property-editor>\r\n    )\r\n  }\r\n}\r\n\r\nTunnel.injectProps(ElsaMultiTextProperty, ['serverUrl']);\r\n"],"names":[],"mappings":"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"}