{"version":3,"file":"elsa-monaco.entry.esm.js","sources":["src/components/controls/elsa-monaco/elsa-monaco.css?tag=elsa-monaco","src/components/controls/elsa-monaco/elsa-monaco.tsx"],"sourcesContent":[".elsa-monaco-editor-host {\r\n  display: block;\r\n  position: relative;\r\n  min-height: 6em;\r\n}\r\n\r\n.elsa-monaco-editor-container {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  max-height: 100% !important;\r\n  margin: 0;\r\n  padding: 0;\r\n}\r\n\r\n.elsa-monaco-editor {\r\n  border-radius: 0.25rem;\r\n}\r\n\r\n.elsa-monaco-editor .overflow-guard {\r\n  border-radius: 0.25rem;\r\n}\r\n\r\n.elsa-monaco-editor .suggest-widget div.tree {\r\n  white-space: unset;\r\n  padding-bottom: 0;\r\n}\r\n","import { Component, Event, EventEmitter, h, Host, Method, Prop, Watch } from '@stencil/core';\r\nimport { initializeMonacoWorker, Monaco, EditorVariables } from \"./elsa-monaco-utils\";\r\nimport state from '../../../utils/store';\r\n\r\nexport interface MonacoValueChangedArgs {\r\n  value: string;\r\n  markers: Array<any>;\r\n}\r\n\r\n@Component({\r\n  tag: 'elsa-monaco',\r\n  styleUrl: 'elsa-monaco.css',\r\n  shadow: false\r\n})\r\nexport class ElsaMonaco {\r\n  private monaco: Monaco;\r\n\r\n  @Prop({ attribute: 'monaco-lib-path' }) monacoLibPath: string;\r\n  @Prop({ attribute: 'editor-height', reflect: true }) editorHeight: string = '5em';\r\n  @Prop() value: string;\r\n  @Prop() language: string;\r\n  @Prop({ attribute: 'single-line', reflect: true }) singleLineMode: boolean = false;\r\n  @Prop() padding: string;\r\n  @Event({ eventName: 'valueChanged' }) valueChanged: EventEmitter<MonacoValueChangedArgs>;\r\n\r\n  container: HTMLElement;\r\n  editor: any;\r\n\r\n  @Watch('language')\r\n  languageChangeHandler(newValue: string) {\r\n    if (!this.editor)\r\n      return;\r\n\r\n    const model = this.editor.getModel();\r\n    this.monaco.editor.setModelLanguage(model, this.language);\r\n  }\r\n\r\n  @Method()\r\n  async setValue(value: string) {\r\n    if (!this.editor)\r\n      return;\r\n\r\n    const model = this.editor.getModel();\r\n    model.setValue(value || '');\r\n  }\r\n\r\n  @Method()\r\n  async addJavaScriptLib(libSource: string, libUri: string) {\r\n    const monaco = this.monaco;\r\n    monaco.languages.typescript.javascriptDefaults.setExtraLibs([{\r\n      filePath: \"lib.es5.d.ts\"\r\n    }, {\r\n      content: libSource,\r\n      filePath: libUri\r\n    }]);\r\n\r\n    const oldModel = monaco.editor.getModel(libUri);\r\n\r\n    if (oldModel)\r\n      oldModel.dispose();\r\n\r\n    const newModel = monaco.editor.createModel(libSource, 'typescript', monaco.Uri.parse(libUri));    \r\n    \r\n    const matches = libSource.matchAll(/declare const (\\w+): (string|number)/g);\r\n\r\n    EditorVariables.splice(0, EditorVariables.length);\r\n    \r\n    for(const match of matches) {\r\n      EditorVariables.push({variableName: match[1], type: match[2] });\r\n    }\r\n  }\r\n\r\n  async componentWillLoad() {\r\n    const monacoLibPath = this.monacoLibPath ?? state.monacoLibPath;\r\n    this.monaco = await initializeMonacoWorker(monacoLibPath);\r\n  }\r\n\r\n  componentDidLoad() {\r\n    const monaco = this.monaco;\r\n    const language = this.language;\r\n\r\n    // Validation settings.\r\n    monaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({\r\n      noSemanticValidation: true,\r\n      noSyntaxValidation: false,\r\n    });\r\n\r\n    // Compiler options.\r\n    monaco.languages.typescript.javascriptDefaults.setCompilerOptions({\r\n      target: monaco.languages.typescript.ScriptTarget.ES2020,\r\n      lib: [],\r\n      allowNonTsExtensions: true\r\n    });\r\n\r\n    monaco.languages.typescript.javascriptDefaults.setEagerModelSync(true);\r\n\r\n    const defaultOptions = {\r\n      value: this.value,\r\n      language: language,\r\n      fontFamily: \"Roboto Mono, monospace\",\r\n      renderLineHighlight: 'none',\r\n      minimap: {\r\n        enabled: false\r\n      },\r\n      automaticLayout: true,\r\n      lineNumbers: \"on\",\r\n      theme: \"vs\",\r\n      roundedSelection: true,\r\n      scrollBeyondLastLine: false,\r\n      readOnly: false,\r\n      overviewRulerLanes: 0,\r\n      overviewRulerBorder: false,\r\n      lineDecorationsWidth: 0,\r\n      hideCursorInOverviewRuler: true,\r\n      glyphMargin: false\r\n    };\r\n\r\n    let options = defaultOptions;\r\n\r\n    if (this.singleLineMode) {\r\n      options = {\r\n        ...defaultOptions, ...{\r\n          wordWrap: 'off',\r\n          lineNumbers: 'off',\r\n          lineNumbersMinChars: 0,\r\n          folding: false,\r\n          scrollBeyondLastColumn: 0,\r\n          scrollbar: { horizontal: 'hidden', vertical: 'hidden' },\r\n          find: { addExtraSpaceOnTop: false, autoFindInSelection: 'never', seedSearchStringFromSelection: false },\r\n        }\r\n      }\r\n    }\r\n\r\n    this.editor = monaco.editor.create(this.container, options);\r\n\r\n    this.editor.onDidChangeModelContent(e => {\r\n      const value = this.editor.getValue();\r\n      const markers = monaco.editor.getModelMarkers({ owner: language });\r\n      this.valueChanged.emit({ value: value, markers: markers });\r\n    });\r\n\r\n    if (this.singleLineMode) {\r\n      this.editor.onKeyDown(e => {\r\n        if (e.keyCode == monaco.KeyCode.Enter) {\r\n          // We only prevent enter when the suggest model is not active\r\n          if (this.editor.getContribution('editor.contrib.suggestController').model.state == 0) {\r\n            e.preventDefault();\r\n          }\r\n        }\r\n      });\r\n\r\n      this.editor.onDidPaste(e => {\r\n        if (e.range.endLineNumber > 1) {\r\n          let newContent = \"\";\r\n          const model = this.editor.getModel();\r\n          let lineCount = model.getLineCount();\r\n          for (let i = 0; i < lineCount; i++) {\r\n            newContent += model.getLineContent(i + 1);\r\n          }\r\n          model.setValue(newContent);\r\n        }\r\n      });\r\n    }\r\n  }\r\n\r\n  disconnectedCallback() {\r\n    const editor = this.editor;\r\n\r\n    if (!!editor)\r\n      editor.dispose();\r\n  }\r\n\r\n  render() {\r\n    const padding = this.padding || 'elsa-pt-1.5 elsa-pl-1';\r\n    return (\r\n      <Host\r\n        class=\"elsa-monaco-editor-host elsa-border focus:elsa-ring-blue-500 focus:elsa-border-blue-500 elsa-block elsa-w-full elsa-min-w-0 elsa-rounded-md sm:elsa-text-sm elsa-border-gray-300 elsa-p-4\"\r\n        style={{ 'min-height': this.editorHeight }}>\r\n        <div ref={el => this.container = el} class={`elsa-monaco-editor-container ${padding}`} />\r\n      </Host>\r\n    )\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}