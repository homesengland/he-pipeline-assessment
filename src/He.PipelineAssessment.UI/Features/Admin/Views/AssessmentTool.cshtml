@using He.PipelineAssessment.UI.Features.Admin.AssessmentToolManagement.Queries.GetAssessmentTools;
@model AssessmentToolListData;

@{
    ViewData["Title"] = "Assessment Tools";
    Layout = "_Layout";
}

<div class="text-center">
    <div class="text-center">
        <table class="govuk-table">
            <caption class="govuk-table__caption govuk-table__caption--m">Assessment Tools</caption>
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header">Name</th>
                    <th scope="col" class="govuk-table__header">Order</th>                    
                    <th scope="col" class="govuk-table__header">Update</th>
                    <th scope="col" class="govuk-table__header">Remove</th>
                    <th scope="col" class="govuk-table__header">Assessment Tool Workflows</th>
                </tr>
            </thead>
            <tbody class="govuk-table__body">
                @foreach (var assessmentTool in Model.AssessmentTools)
                {
                    <tr class="govuk-table__row">
                        @using (Html.BeginForm("UpdateAssessmentTool", "Admin", FormMethod.Post))
                        {
                            <td class="govuk-table__cell">
                                @Html.TextBox("name", assessmentTool.Name, "", new { @class = "govuk-input" })
                            </td>
                            <td class="govuk-table__cell">
                                @Html.TextBox("order", assessmentTool.Order, "", new { @class = "govuk-input" })
                            </td>
                            <td class="govuk-table__cell">
                                @Html.AntiForgeryToken()
                                @Html.Hidden("id", assessmentTool.Id)
                                <input class="govuk-button govuk-!-margin-0" data-module="govuk-button" id="Update" type="submit" value="Update"/>
                            </td>
                        }
                        <td class="govuk-table__cell">
                            @Html.ActionLink("Remove", "GetAssessmentToolById","Admin",new {assessmentToolId = assessmentTool.Id})
                        </td>
                        <td class="govuk-table__cell">
                            <table class="govuk-table" style="margin-bottom: 0">
                                <tbody class="govuk-table__body">
                                @foreach (var assessmentToolWorkflow in assessmentTool.AssessmentToolWorkFlows)
                                {
                                    <tr class="govuk-table__row">
                                        <td class="govuk-table__cell">
                                            @assessmentToolWorkflow.WorkflowDefinitionId
                                        </td>
                                        <td class="govuk-table__cell">
                                            @if(assessmentToolWorkflow.IsFirstWorkflow)
                                            {
                                                @:First workflow
                                            }
                                        </td>
                                    </tr>
                                }
                            </table>
                            @Html.ActionLink("Manage Assessmenttool Workflow", "AssessmentToolWorkflow","Admin",new {assessmentToolId = assessmentTool.Id})
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        @Html.ActionLink("Create Assessment Tool", "LoadAssessmentTool","Admin", null, new {@class = "govuk-link"})
    </div>
</div>